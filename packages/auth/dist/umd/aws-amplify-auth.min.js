/*! For license information please see aws-amplify-auth.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("aws_amplify_core")):"function"==typeof define&&define.amd?define("aws_amplify_auth",["aws_amplify_core"],t):"object"==typeof exports?exports.aws_amplify_auth=t(require("aws_amplify_core")):e.aws_amplify_auth=t(e.aws_amplify_core)}(this,(e=>(()=>{"use strict";var t={2:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RawSha256=void 0;var o=n(149),i=function(){function e(){this.state=Int32Array.from(o.INIT),this.temp=new Int32Array(64),this.buffer=new Uint8Array(64),this.bufferLength=0,this.bytesHashed=0,this.finished=!1}return e.prototype.update=function(e){if(this.finished)throw new Error("Attempted to update an already finished hash.");var t=0,n=e.byteLength;if(this.bytesHashed+=n,8*this.bytesHashed>o.MAX_HASHABLE_LENGTH)throw new Error("Cannot hash more than 2^53 - 1 bits");for(;n>0;)this.buffer[this.bufferLength++]=e[t++],n--,this.bufferLength===o.BLOCK_SIZE&&(this.hashBuffer(),this.bufferLength=0)},e.prototype.digest=function(){if(!this.finished){var e=8*this.bytesHashed,t=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.byteLength),n=this.bufferLength;if(t.setUint8(this.bufferLength++,128),n%o.BLOCK_SIZE>=o.BLOCK_SIZE-8){for(var i=this.bufferLength;i<o.BLOCK_SIZE;i++)t.setUint8(i,0);this.hashBuffer(),this.bufferLength=0}for(i=this.bufferLength;i<o.BLOCK_SIZE-8;i++)t.setUint8(i,0);t.setUint32(o.BLOCK_SIZE-8,Math.floor(e/4294967296),!0),t.setUint32(o.BLOCK_SIZE-4,e),this.hashBuffer(),this.finished=!0}var r=new Uint8Array(o.DIGEST_LENGTH);for(i=0;i<8;i++)r[4*i]=this.state[i]>>>24&255,r[4*i+1]=this.state[i]>>>16&255,r[4*i+2]=this.state[i]>>>8&255,r[4*i+3]=this.state[i]>>>0&255;return r},e.prototype.hashBuffer=function(){for(var e=this.buffer,t=this.state,n=t[0],i=t[1],r=t[2],s=t[3],a=t[4],c=t[5],u=t[6],d=t[7],l=0;l<o.BLOCK_SIZE;l++){if(l<16)this.temp[l]=(255&e[4*l])<<24|(255&e[4*l+1])<<16|(255&e[4*l+2])<<8|255&e[4*l+3];else{var p=this.temp[l-2],h=(p>>>17|p<<15)^(p>>>19|p<<13)^p>>>10,f=((p=this.temp[l-15])>>>7|p<<25)^(p>>>18|p<<14)^p>>>3;this.temp[l]=(h+this.temp[l-7]|0)+(f+this.temp[l-16]|0)}var g=(((a>>>6|a<<26)^(a>>>11|a<<21)^(a>>>25|a<<7))+(a&c^~a&u)|0)+(d+(o.KEY[l]+this.temp[l]|0)|0)|0,E=((n>>>2|n<<30)^(n>>>13|n<<19)^(n>>>22|n<<10))+(n&i^n&r^i&r)|0;d=u,u=c,c=a,a=s+g|0,s=r,r=i,i=n,n=g+E|0}t[0]+=n,t[1]+=i,t[2]+=r,t[3]+=s,t[4]+=a,t[5]+=c,t[6]+=u,t[7]+=d},e}();t.RawSha256=i},149:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_HASHABLE_LENGTH=t.INIT=t.KEY=t.DIGEST_LENGTH=t.BLOCK_SIZE=void 0,t.BLOCK_SIZE=64,t.DIGEST_LENGTH=32,t.KEY=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),t.INIT=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],t.MAX_HASHABLE_LENGTH=Math.pow(2,53)-1},387:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),n(205).__exportStar(n(572),t)},572:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Sha256=void 0;var o=n(205),i=n(149),r=n(2),s=n(959),a=function(){function e(e){this.secret=e,this.hash=new r.RawSha256,this.reset()}return e.prototype.update=function(e){if(!(0,s.isEmptyData)(e)&&!this.error)try{this.hash.update((0,s.convertToBuffer)(e))}catch(e){this.error=e}},e.prototype.digestSync=function(){if(this.error)throw this.error;return this.outer?(this.outer.finished||this.outer.update(this.hash.digest()),this.outer.digest()):this.hash.digest()},e.prototype.digest=function(){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(e){return[2,this.digestSync()]}))}))},e.prototype.reset=function(){if(this.hash=new r.RawSha256,this.secret){this.outer=new r.RawSha256;var e=function(e){var t=(0,s.convertToBuffer)(e);if(t.byteLength>i.BLOCK_SIZE){var n=new r.RawSha256;n.update(t),t=n.digest()}var o=new Uint8Array(i.BLOCK_SIZE);return o.set(t),o}(this.secret),t=new Uint8Array(i.BLOCK_SIZE);t.set(e);for(var n=0;n<i.BLOCK_SIZE;n++)e[n]^=54,t[n]^=92;for(this.hash.update(e),this.outer.update(t),n=0;n<e.byteLength;n++)e[n]=0}},e}();t.Sha256=a},205:(e,t,n)=>{n.r(t),n.d(t,{__assign:()=>r,__asyncDelegator:()=>x,__asyncGenerator:()=>S,__asyncValues:()=>I,__await:()=>y,__awaiter:()=>d,__classPrivateFieldGet:()=>C,__classPrivateFieldSet:()=>P,__createBinding:()=>p,__decorate:()=>a,__exportStar:()=>h,__extends:()=>i,__generator:()=>l,__importDefault:()=>v,__importStar:()=>A,__makeTemplateObject:()=>w,__metadata:()=>u,__param:()=>c,__read:()=>g,__rest:()=>s,__spread:()=>E,__spreadArrays:()=>m,__values:()=>f});var o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},o(e,t)};function i(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var r=function(){return r=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)};function s(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(n[o[i]]=e[o[i]])}return n}function a(e,t,n,o){var i,r=arguments.length,s=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(r<3?i(s):r>3?i(t,n,s):i(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s}function c(e,t){return function(n,o){t(n,o,e)}}function u(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function d(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{c(o.next(e))}catch(e){r(e)}}function a(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))}function l(e,t){var n,o,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}function p(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}function h(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||(t[n]=e[n])}function f(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function g(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,i,r=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(e){i={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(i)throw i.error}}return s}function E(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(g(arguments[t]));return e}function m(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var o=Array(e),i=0;for(t=0;t<n;t++)for(var r=arguments[t],s=0,a=r.length;s<a;s++,i++)o[i]=r[s];return o}function y(e){return this instanceof y?(this.v=e,this):new y(e)}function S(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o,i=n.apply(e,t||[]),r=[];return o={},s("next"),s("throw"),s("return"),o[Symbol.asyncIterator]=function(){return this},o;function s(e){i[e]&&(o[e]=function(t){return new Promise((function(n,o){r.push([e,t,n,o])>1||a(e,t)}))})}function a(e,t){try{(n=i[e](t)).value instanceof y?Promise.resolve(n.value.v).then(c,u):d(r[0][2],n)}catch(e){d(r[0][3],e)}var n}function c(e){a("next",e)}function u(e){a("throw",e)}function d(e,t){e(t),r.shift(),r.length&&a(r[0][0],r[0][1])}}function x(e){var t,n;return t={},o("next"),o("throw",(function(e){throw e})),o("return"),t[Symbol.iterator]=function(){return this},t;function o(o,i){t[o]=e[o]?function(t){return(n=!n)?{value:y(e[o](t)),done:"return"===o}:i?i(t):t}:i}}function I(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=f(e),t={},o("next"),o("throw"),o("return"),t[Symbol.asyncIterator]=function(){return this},t);function o(n){t[n]=e[n]&&function(t){return new Promise((function(o,i){!function(e,t,n,o){Promise.resolve(o).then((function(t){e({value:t,done:n})}),t)}(o,i,(t=e[n](t)).done,t.value)}))}}}function w(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}function A(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function v(e){return e&&e.__esModule?e:{default:e}}function C(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)}function P(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n}},376:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.convertToBuffer=void 0;var o=n(778),i="undefined"!=typeof Buffer&&Buffer.from?function(e){return Buffer.from(e,"utf8")}:o.fromUtf8;t.convertToBuffer=function(e){return e instanceof Uint8Array?e:"string"==typeof e?i(e):ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(e)}},959:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.uint32ArrayFrom=t.numToUint8=t.isEmptyData=t.convertToBuffer=void 0;var o=n(376);Object.defineProperty(t,"convertToBuffer",{enumerable:!0,get:function(){return o.convertToBuffer}});var i=n(310);Object.defineProperty(t,"isEmptyData",{enumerable:!0,get:function(){return i.isEmptyData}});var r=n(443);Object.defineProperty(t,"numToUint8",{enumerable:!0,get:function(){return r.numToUint8}});var s=n(650);Object.defineProperty(t,"uint32ArrayFrom",{enumerable:!0,get:function(){return s.uint32ArrayFrom}})},310:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isEmptyData=void 0,t.isEmptyData=function(e){return"string"==typeof e?0===e.length:0===e.byteLength}},443:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.numToUint8=void 0,t.numToUint8=function(e){return new Uint8Array([(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e])}},650:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.uint32ArrayFrom=void 0,t.uint32ArrayFrom=function(e){if(!Uint32Array.from){for(var t=new Uint32Array(e.length),n=0;n<e.length;)t[n]=e[n],n+=1;return t}return Uint32Array.from(e)}},778:(e,t,n)=>{n.r(t),n.d(t,{fromUtf8:()=>o,toUtf8:()=>i});const o=e=>"function"==typeof TextEncoder?function(e){return(new TextEncoder).encode(e)}(e):(e=>{const t=[];for(let n=0,o=e.length;n<o;n++){const o=e.charCodeAt(n);if(o<128)t.push(o);else if(o<2048)t.push(o>>6|192,63&o|128);else if(n+1<e.length&&55296==(64512&o)&&56320==(64512&e.charCodeAt(n+1))){const i=65536+((1023&o)<<10)+(1023&e.charCodeAt(++n));t.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}else t.push(o>>12|224,o>>6&63|128,63&o|128)}return Uint8Array.from(t)})(e),i=e=>"function"==typeof TextDecoder?function(e){return new TextDecoder("utf-8").decode(e)}(e):(e=>{let t="";for(let n=0,o=e.length;n<o;n++){const o=e[n];if(o<128)t+=String.fromCharCode(o);else if(192<=o&&o<224){const i=e[++n];t+=String.fromCharCode((31&o)<<6|63&i)}else if(240<=o&&o<365){const i="%"+[o,e[++n],e[++n],e[++n]].map((e=>e.toString(16))).join("%");t+=decodeURIComponent(i)}else t+=String.fromCharCode((15&o)<<12|(63&e[++n])<<6|63&e[++n])}return t})(e)},346:t=>{t.exports=e}},n={};function o(e){var i=n[e];if(void 0!==i)return i.exports;var r=n[e]={exports:{}};return t[e](r,r.exports,o),r.exports}o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{o.r(i),o.d(i,{AuthError:()=>de,autoSignIn:()=>to,confirmResetPassword:()=>So,confirmSignIn:()=>wo,confirmSignUp:()=>Io,confirmUserAttribute:()=>Do,decodeJWT:()=>e.decodeJWT,deleteUser:()=>ai,deleteUserAttributes:()=>si,fetchAuthSession:()=>e.fetchAuthSession,fetchDevices:()=>li,fetchMFAPreference:()=>Co,fetchUserAttributes:()=>ei,forgetDevice:()=>ui,getCurrentUser:()=>yn,rememberDevice:()=>ci,resendSignUpCode:()=>xo,resetPassword:()=>yo,sendUserAttributeVerificationCode:()=>ri,setUpTOTP:()=>To,signIn:()=>Xn,signInWithRedirect:()=>Qo,signOut:()=>oi,signUp:()=>mo,updateMFAPreference:()=>Ao,updatePassword:()=>Ro,updateUserAttribute:()=>_o,updateUserAttributes:()=>Uo,verifyTOTPSetup:()=>Po});var e=o(346);class t extends Error{constructor({message:e,name:n,recoverySuggestion:o,underlyingError:i}){super(e),this.name=n,this.underlyingError=i,this.recoverySuggestion=o,this.constructor=t,Object.setPrototypeOf(this,t.prototype)}}const n=(e,n=t)=>(t,o,i)=>{const{message:r,recoverySuggestion:s}=e[o];if(!t)throw new n({name:o,message:i?`${r} ${i}`:r,recoverySuggestion:s})};var r,s;(s=r||(r={})).AuthTokenConfigException="AuthTokenConfigException",s.AuthUserPoolAndIdentityPoolException="AuthUserPoolAndIdentityPoolException",s.AuthUserPoolException="AuthUserPoolException",s.InvalidIdentityPoolIdException="InvalidIdentityPoolIdException",s.OAuthNotConfigureException="OAuthNotConfigureException";const a=n({[r.AuthTokenConfigException]:{message:"Auth Token Provider not configured.",recoverySuggestion:"Make sure to call Amplify.configure in your app."},[r.AuthUserPoolAndIdentityPoolException]:{message:"Auth UserPool or IdentityPool not configured.",recoverySuggestion:"Make sure to call Amplify.configure in your app with UserPoolId and IdentityPoolId."},[r.AuthUserPoolException]:{message:"Auth UserPool not configured.",recoverySuggestion:"Make sure to call Amplify.configure in your app with userPoolId and userPoolClientId."},[r.InvalidIdentityPoolIdException]:{message:"Invalid identity pool id provided.",recoverySuggestion:"Make sure a valid identityPoolId is given in the config."},[r.OAuthNotConfigureException]:{message:"oauth param not configured.",recoverySuggestion:"Make sure to call Amplify.configure with oauth parameter in your app."}}),c=()=>{if("object"==typeof window&&"object"==typeof window.crypto)return window.crypto;if("object"==typeof crypto)return crypto;throw new t({name:"MissingPolyfill",message:"Cannot resolve the `crypto` function from the environment."})},u={convert:e=>(()=>{if("undefined"!=typeof window&&"function"==typeof window.atob)return window.atob;if("function"==typeof atob)return atob;throw new t({name:"Base64EncoderError",message:"Cannot resolve the `atob` function from the environment."})})()(e)};function d(e){let t=!0;return t=!!e&&!!e.userPoolId&&!!e.userPoolClientId,a(t,r.AuthUserPoolException)}function l(e){return a(!!(e?.loginWith?.oauth?.domain&&e?.loginWith?.oauth?.redirectSignOut&&e?.loginWith?.oauth?.redirectSignIn&&e?.loginWith?.oauth?.responseType),r.OAuthNotConfigureException)}function p(e){const t=e.split(".");if(3!==t.length)throw new Error("Invalid token");try{const n=t[1].replace(/-/g,"+").replace(/_/g,"/"),o=decodeURIComponent(u.convert(n).split("").map((e=>`%${`00${e.charCodeAt(0).toString(16)}`.slice(-2)}`)).join(""));return{toString:()=>e,payload:JSON.parse(o)}}catch(e){throw new Error("Invalid token payload")}}var h,f,g,E,m,y,S,x,I,w,A,v,C;!function(e){e.WebUnknown="0",e.React="1",e.NextJs="2",e.Angular="3",e.VueJs="4",e.Nuxt="5",e.Svelte="6",e.ServerSideUnknown="100",e.ReactSSR="101",e.NextJsSSR="102",e.AngularSSR="103",e.VueJsSSR="104",e.NuxtSSR="105",e.SvelteSSR="106",e.ReactNative="201",e.Expo="202"}(h||(h={})),function(e){e.API="api",e.Auth="auth",e.Analytics="analytics",e.DataStore="datastore",e.Geo="geo",e.InAppMessaging="inappmessaging",e.Interactions="interactions",e.Predictions="predictions",e.PubSub="pubsub",e.PushNotification="pushnotification",e.Storage="storage"}(f||(f={})),function(e){e.Record="1",e.IdentifyUser="2"}(g||(g={})),function(e){e.GraphQl="1",e.Get="2",e.Post="3",e.Put="4",e.Patch="5",e.Del="6",e.Head="7"}(E||(E={})),function(e){e.SignUp="1",e.ConfirmSignUp="2",e.ResendSignUpCode="3",e.SignIn="4",e.FetchMFAPreference="6",e.UpdateMFAPreference="7",e.SetUpTOTP="10",e.VerifyTOTPSetup="11",e.ConfirmSignIn="12",e.DeleteUserAttributes="15",e.DeleteUser="16",e.UpdateUserAttributes="17",e.FetchUserAttributes="18",e.ConfirmUserAttribute="22",e.SignOut="26",e.UpdatePassword="27",e.ResetPassword="28",e.ConfirmResetPassword="29",e.FederatedSignIn="30",e.RememberDevice="32",e.ForgetDevice="33",e.FetchDevices="34",e.SendUserAttributeVerificationCode="35",e.SignInWithRedirect="36"}(m||(m={})),function(e){e.Subscribe="1",e.GraphQl="2"}(y||(y={})),function(e){e.SearchByText="0",e.SearchByCoordinates="1",e.SearchForSuggestions="2",e.SearchByPlaceId="3",e.SaveGeofences="4",e.GetGeofence="5",e.ListGeofences="6",e.DeleteGeofences="7"}(S||(S={})),function(e){e.SyncMessages="1",e.IdentifyUser="2",e.NotifyMessageInteraction="3"}(x||(x={})),function(e){e.None="0"}(I||(I={})),function(e){e.Convert="1",e.Identify="2",e.Interpret="3"}(w||(w={})),function(e){e.Subscribe="1"}(A||(A={})),function(e){e.InitializePushNotifications="1",e.IdentifyUser="2"}(v||(v={})),function(e){e.UploadData="1",e.DownloadData="2",e.List="3",e.Copy="4",e.Remove="5",e.GetProperties="6",e.GetUrl="7"}(C||(C={}));const P=(e,t,n,o)=>async(i,r)=>{const s={...o,...i},a=await s.endpointResolver(s,r),c=await t(r,a),u=await e(c,{...s});return await n(u)},R={id:"aws",outputs:{dnsSuffix:"amazonaws.com"},regionRegex:"^(us|eu|ap|sa|ca|me|af)\\-\\w+\\-\\d+$",regions:["aws-global"]},T={partitions:[R,{id:"aws-cn",outputs:{dnsSuffix:"amazonaws.com.cn"},regionRegex:"^cn\\-\\w+\\-\\d+$",regions:["aws-cn-global"]}]},U=(e,t)=>{if(t?.aborted)return Promise.resolve();let n,o;const i=new Promise((t=>{o=t,n=setTimeout(t,e)}));return t?.addEventListener("abort",(function e(i){clearTimeout(n),t?.removeEventListener("abort",e),o()})),i},N=(e,t)=>{"[object Object]"===Object.prototype.toString.call(e)&&(e.$metadata={...e.$metadata??{},attempts:t})},b=(e,t)=>(n,o)=>{const i={};let r=t=>e(t,o);for(let e=t.length-1;e>=0;e--)r=(0,t[e])(o)(r,i);return r(n)},_=e=>{let t;return()=>(t||(t=e()),t)},D=e=>!["HEAD","GET","DELETE"].includes(e.toUpperCase()),M=b((async({url:e,method:t,headers:n,body:o},{abortSignal:i,cache:r,withCrossDomainCredentials:s})=>{let a;try{a=await fetch(e,{method:t,headers:n,body:D(t)?o:void 0,signal:i,cache:r,credentials:s?"include":"same-origin"})}catch(e){if(e instanceof TypeError)throw new Error("Network error");throw e}const c={};return a.headers?.forEach(((e,t)=>{c[t.toLowerCase()]=e})),{statusCode:a.status,headers:c,body:null,body:Object.assign(a.body??{},{text:_((()=>a.text())),blob:_((()=>a.blob())),json:_((()=>a.json()))})}}),[({userAgentHeader:e="x-amz-user-agent",userAgentValue:t=""})=>n=>async function(o){if(0===t.trim().length)return await n(o);{const i=e.toLowerCase();return o.headers[i]=o.headers[i]?`${o.headers[i]} ${t}`:t,await n(o)}},({maxAttempts:e=3,retryDecider:t,computeDelay:n,abortSignal:o})=>{if(e<1)throw new Error("maxAttempts must be greater than 0");return(i,r)=>async function(s){let a,c,u=r.attemptsCount??0;const d=()=>{if(c)return N(c,u),c;throw N(a,u),a};for(;!o?.aborted&&u<e;){try{c=await i(s),a=void 0}catch(e){a=e,c=void 0}if(u=(r.attemptsCount??0)>u?r.attemptsCount??0:u+1,r.attemptsCount=u,!await t(c,a))return d();if(!o?.aborted&&u<e){const e=n(u);await U(e,o)}}if(o?.aborted)throw new Error("Request aborted.");return d()}}]),F=["AuthFailure","InvalidSignatureException","RequestExpired","RequestInTheFuture","RequestTimeTooSkewed","SignatureDoesNotMatch","BadRequestException"],O=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException"],k=["TimeoutError","RequestTimeout","RequestTimeoutException"],L=e=>{const{headers:t,statusCode:n}=e;return{...V(e)?e.$metadata:{},httpStatusCode:n,requestId:t["x-amzn-requestid"]??t["x-amzn-request-id"]??t["x-amz-request-id"],extendedRequestId:t["x-amz-id-2"],cfId:t["x-amz-cf-id"]}},V=e=>"object"==typeof e?.$metadata,K=async e=>{if(!e||e.statusCode<300)return;const t=await B(e),n=(e=>{const[t]=e.toString().split(/[\,\:]+/);return t.includes("#")?t.split("#")[1]:t})(e.headers["x-amzn-errortype"]??t.code??t.__type??"UnknownError"),o=t.message??t.Message??"Unknown error",i=new Error(o);return Object.assign(i,{name:n,$metadata:L(e)})},B=async e=>{if(!e.body)throw new Error("Missing response payload");const t=await e.body.json();return Object.assign(t,{$metadata:L(e)})},q=3e5,G=URL,H="6.0.12",W=()=>"undefined"!=typeof global,$=()=>"undefined"!=typeof window,j=()=>"undefined"!=typeof document,z=()=>"undefined"!=typeof process,Y=(e,t)=>!!Object.keys(e).find((e=>e.startsWith(t))),Z=[{platform:h.Expo,detectionMethod:function(){return W()&&void 0!==global.expo}},{platform:h.ReactNative,detectionMethod:function(){return"undefined"!=typeof navigator&&void 0!==navigator.product&&"ReactNative"===navigator.product}},{platform:h.NextJs,detectionMethod:function(){return $()&&window.next&&"object"==typeof window.next}},{platform:h.Nuxt,detectionMethod:function(){return $()&&(void 0!==window.__NUXT__||void 0!==window.$nuxt)}},{platform:h.Angular,detectionMethod:function(){const e=Boolean(j()&&document.querySelector("[ng-version]")),t=Boolean($()&&void 0!==window.ng);return e||t}},{platform:h.React,detectionMethod:function(){const e=e=>e.startsWith("_react")||e.startsWith("__react");return j()&&Array.from(document.querySelectorAll("[id]")).some((t=>Object.keys(t).find(e)))}},{platform:h.VueJs,detectionMethod:function(){return $()&&Y(window,"__VUE")}},{platform:h.Svelte,detectionMethod:function(){return $()&&Y(window,"__SVELTE")}},{platform:h.WebUnknown,detectionMethod:function(){return $()}},{platform:h.NextJsSSR,detectionMethod:function(){return W()&&(Y(global,"__next")||Y(global,"__NEXT"))}},{platform:h.NuxtSSR,detectionMethod:function(){return W()&&void 0!==global.__NUXT_PATHS__}},{platform:h.ReactSSR,detectionMethod:function(){return z()&&void 0!==process.env&&!!Object.keys(process.env).find((e=>e.includes("react")))}},{platform:h.VueJsSSR,detectionMethod:function(){return W()&&Y(global,"__VUE")}},{platform:h.AngularSSR,detectionMethod:function(){return z()&&"object"==typeof process.env&&process.env.npm_lifecycle_script?.startsWith("ng ")||!1}},{platform:h.SvelteSSR,detectionMethod:function(){return z()&&void 0!==process.env&&!!Object.keys(process.env).find((e=>e.includes("svelte")))}}];let J;const Q=[];let X=!1;const ee=()=>{if(!J){if(J=Z.find((e=>e.detectionMethod()))?.platform||h.ServerSideUnknown,X)for(;Q.length;)Q.pop()?.();else Q.forEach((e=>e()));te(h.ServerSideUnknown,10),te(h.WebUnknown,10)}return J};function te(e,t){J!==e||X||setTimeout((()=>{J=void 0,X=!0,setTimeout(ee,1e3)}),t)}const ne={},oe="aws-amplify";new class{constructor(){this.userAgent=`${oe}/${H}`}get framework(){return ee()}get isReactNative(){return this.framework===h.ReactNative||this.framework===h.Expo}observeFrameworkChanges(e){(e=>{X||Q.push(e)})(e)}};const ie=e=>(({category:e,action:t,framework:n}={})=>{const o=[[oe,H]];if(e&&o.push([e,t]),o.push(["framework",ee()]),e&&t){const n=((e,t)=>ne[e]?.[t]?.additionalDetails)(e,t);n&&n.forEach((e=>{o.push(e)}))}return o})(e).map((([e,t])=>e&&t?`${e}/${t}`:e)).join(" "),re="cognito-idp",se=b(M,[()=>(e,t)=>async function(t){return t.headers["cache-control"]="no-store",e(t)}]),ae={service:re,endpointResolver:({region:t})=>{const n=e.Amplify.getConfig().Auth?.Cognito,o=n?.userPoolEndpoint,i=new G(`https://${re}.${t}.${(e=>{const{partitions:t}=T;for(const{regions:n,outputs:o,regionRegex:i}of t){const t=new RegExp(i);if(n.includes(e)||t.test(e))return o.dnsSuffix}return R.outputs.dnsSuffix})(t)}`);return{url:o?new G(o):i}},retryDecider:(ce=K,async(e,t)=>{const n=t??await ce(e)??void 0,o=n?.code,i=e?.statusCode;return(e=>"Network error"===e?.name)(t)||((e,t)=>429===e||!!t&&O.includes(t))(i,o)||(e=>!!e&&F.includes(e))(o)||((e,t)=>!!e&&[500,502,503,504].includes(e)||!!t&&k.includes(t))(i,o)}),computeDelay:e=>{const t=function(e=3e5){return t=>{const n=2**t*100+100*Math.random();return!(n>e)&&n}}(q),n=t(e);return!1===n?q:n},userAgentValue:ie(),cache:"no-store"};var ce,ue;class de extends t{constructor(e){super(e),this.constructor=de,Object.setPrototypeOf(this,de.prototype)}}function le(e){if(!e||"Error"===e.name||e instanceof TypeError)throw new de({name:ue.Unknown,message:"An unknown error has occurred.",underlyingError:e})}!function(e){e.NoEndpointId="NoEndpointId",e.PlatformNotSupported="PlatformNotSupported",e.Unknown="Unknown"}(ue||(ue={}));const pe=e=>(t,n)=>{const o=(e=>({"content-type":"application/x-amz-json-1.1","x-amz-target":`AWSCognitoIdentityProviderService.${e}`}))(e);return(({url:e},t,n)=>({headers:t,url:e,body:n,method:"POST"}))(n,o,JSON.stringify(t))},he=()=>async e=>{if(e.statusCode>=300){const t=await K(e);throw le(t),new de({name:t.name,message:t.message})}return await B(e)},fe=()=>async e=>{if(e.statusCode>=300){const t=await K(e);throw le(t),new de({name:t.name,message:t.message})}},ge=P(se,pe("InitiateAuth"),he(),ae),Ee=P(se,pe("RevokeToken"),he(),ae),me=P(se,pe("SignUp"),he(),ae),ye=P(se,pe("ConfirmSignUp"),he(),ae),Se=P(se,pe("ForgotPassword"),he(),ae),xe=P(se,pe("ConfirmForgotPassword"),he(),ae),Ie=P(se,pe("RespondToAuthChallenge"),he(),ae),we=P(se,pe("ResendConfirmationCode"),he(),ae),Ae=P(se,pe("VerifySoftwareToken"),he(),ae),ve=P(se,pe("AssociateSoftwareToken"),he(),ae),Ce=P(se,pe("SetUserMFAPreference"),he(),ae),Pe=P(se,pe("GetUser"),he(),ae),Re=P(se,pe("ChangePassword"),he(),ae),Te=P(se,pe("ConfirmDevice"),he(),ae),Ue=P(se,pe("ForgetDevice"),fe(),ae),Ne=P(se,pe("DeleteUser"),fe(),ae),be=P(se,pe("GetUserAttributeVerificationCode"),he(),ae),_e=P(se,pe("GlobalSignOut"),he(),ae),De=P(se,pe("UpdateUserAttributes"),he(),ae),Me=P(se,pe("VerifyUserAttribute"),he(),ae),Fe=P(se,pe("UpdateDeviceStatus"),he(),ae),Oe=P(se,pe("ListDevices"),he(),ae),ke=P(se,pe("DeleteUserAttributes"),he(),ae);var Le;!function(e){e.EmptySignInUsername="EmptySignInUsername",e.EmptySignInPassword="EmptySignInPassword",e.CustomAuthSignInPassword="CustomAuthSignInPassword",e.EmptySignUpUsername="EmptySignUpUsername",e.EmptySignUpPassword="EmptySignUpPassword",e.EmptyConfirmSignUpUsername="EmptyConfirmSignUpUsername",e.EmptyConfirmSignUpCode="EmptyConfirmSignUpCode",e.EmptyResendSignUpCodeUsername="EmptyresendSignUpCodeUsername",e.EmptyChallengeResponse="EmptyChallengeResponse",e.EmptyConfirmResetPasswordUsername="EmptyConfirmResetPasswordUsername",e.EmptyConfirmResetPasswordNewPassword="EmptyConfirmResetPasswordNewPassword",e.EmptyConfirmResetPasswordConfirmationCode="EmptyConfirmResetPasswordConfirmationCode",e.EmptyResetPasswordUsername="EmptyResetPasswordUsername",e.EmptyVerifyTOTPSetupCode="EmptyVerifyTOTPSetupCode",e.EmptyConfirmUserAttributeCode="EmptyConfirmUserAttributeCode",e.IncorrectMFAMethod="IncorrectMFAMethod",e.EmptyUpdatePassword="EmptyUpdatePassword"}(Le||(Le={}));const Ve={[Le.EmptyChallengeResponse]:{message:"challengeResponse is required to confirmSignIn"},[Le.EmptyConfirmResetPasswordUsername]:{message:"username is required to confirmResetPassword"},[Le.EmptyConfirmSignUpCode]:{message:"code is required to confirmSignUp"},[Le.EmptyConfirmSignUpUsername]:{message:"username is required to confirmSignUp"},[Le.EmptyConfirmResetPasswordConfirmationCode]:{message:"confirmationCode is required to confirmResetPassword"},[Le.EmptyConfirmResetPasswordNewPassword]:{message:"newPassword is required to confirmResetPassword"},[Le.EmptyResendSignUpCodeUsername]:{message:"username is required to confirmSignUp"},[Le.EmptyResetPasswordUsername]:{message:"username is required to resetPassword"},[Le.EmptySignInPassword]:{message:"password is required to signIn"},[Le.EmptySignInUsername]:{message:"username is required to signIn"},[Le.EmptySignUpPassword]:{message:"password is required to signUp"},[Le.EmptySignUpUsername]:{message:"username is required to signUp"},[Le.CustomAuthSignInPassword]:{message:"A password is not needed when signing in with CUSTOM_WITHOUT_SRP",recoverySuggestion:"Do not include a password in your signIn call."},[Le.IncorrectMFAMethod]:{message:"Incorrect MFA method was chosen. It should be either SMS or TOTP",recoverySuggestion:"Try to pass TOTP or SMS as the challengeResponse"},[Le.EmptyVerifyTOTPSetupCode]:{message:"code is required to verifyTotpSetup"},[Le.EmptyUpdatePassword]:{message:"oldPassword and newPassword are required to changePassword"},[Le.EmptyConfirmUserAttributeCode]:{message:"confirmation code is required to confirmUserAttribute"}};var Ke,Be,qe;function Ge(e,t){const{message:n,recoverySuggestion:o}=Ve[t];if(!e)throw new de({name:t,message:n,recoverySuggestion:o})}function He(e){const t=e?.split("_")[0];if(!e||e.indexOf("_")<0||!t||"string"!=typeof t)throw new de({name:"InvalidUserPoolId",message:"Invalid user pool id provided."});return t}function We(e){return Object.entries(e).map((([e,t])=>({Name:e,Value:t})))}!function(e){e.DEFAULT_MSG="Authentication Error",e.EMPTY_EMAIL="Email cannot be empty",e.EMPTY_PHONE="Phone number cannot be empty",e.EMPTY_USERNAME="Username cannot be empty",e.INVALID_USERNAME="The username should either be a string or one of the sign in types",e.EMPTY_PASSWORD="Password cannot be empty",e.EMPTY_CODE="Confirmation code cannot be empty",e.SIGN_UP_ERROR="Error creating account",e.NO_MFA="No valid MFA method provided",e.INVALID_MFA="Invalid MFA type",e.EMPTY_CHALLENGE="Challenge response cannot be empty",e.NO_USER_SESSION="Failed to get the session because the user is empty",e.NETWORK_ERROR="Network Error",e.DEVICE_CONFIG="Device tracking has not been configured in this User Pool",e.AUTOSIGNIN_ERROR="Please use your credentials to sign in",e.OAUTH_ERROR="Couldn't finish OAuth flow, check your User Pool HostedUI settings"}(Ke||(Ke={})),function(e){e.SignInException="SignInException",e.OAuthSignInError="OAuthSignInException"}(Be||(Be={})),function(e){e.DEBUG="DEBUG",e.ERROR="ERROR",e.INFO="INFO",e.WARN="WARN",e.VERBOSE="VERBOSE"}(qe||(qe={}));const $e={VERBOSE:1,DEBUG:2,INFO:3,WARN:4,ERROR:5};class je{constructor(e,t=qe.WARN){this.name=e,this.level=t,this._pluggables=[]}_padding(e){return e<10?"0"+e:""+e}_ts(){const e=new Date;return[this._padding(e.getMinutes()),this._padding(e.getSeconds())].join(":")+"."+e.getMilliseconds()}configure(e){return e?(this._config=e,this._config):this._config}_log(e,...t){let n=this.level;if(je.LOG_LEVEL&&(n=je.LOG_LEVEL),"undefined"!=typeof window&&window.LOG_LEVEL&&(n=window.LOG_LEVEL),!($e[e]>=$e[n]))return;let o=console.log.bind(console);e===qe.ERROR&&console.error&&(o=console.error.bind(console)),e===qe.WARN&&console.warn&&(o=console.warn.bind(console));const i=`[${e}] ${this._ts()} ${this.name}`;let r="";if(1===t.length&&"string"==typeof t[0])r=`${i} - ${t[0]}`,o(r);else if(1===t.length)r=`${i} ${t[0]}`,o(i,t[0]);else if("string"==typeof t[0]){let e=t.slice(1);1===e.length&&(e=e[0]),r=`${i} - ${t[0]} ${e}`,o(`${i} - ${t[0]}`,e)}else r=`${i} ${t}`,o(i,t);for(const e of this._pluggables){const t={message:r,timestamp:Date.now()};e.pushLogs([t])}}log(...e){this._log(qe.INFO,...e)}info(...e){this._log(qe.INFO,...e)}warn(...e){this._log(qe.WARN,...e)}error(...e){this._log(qe.ERROR,...e)}debug(...e){this._log(qe.DEBUG,...e)}verbose(...e){this._log(qe.VERBOSE,...e)}addPluggable(e){e&&"Logging"===e.getCategoryName()&&(this._pluggables.push(e),e.configure(this._config))}listPluggables(){return this._pluggables}}je.LOG_LEVEL=null;const ze="undefined"!=typeof Symbol?Symbol("amplify_default"):"@@amplify_default",Ye=new je("Hub");class Ze{constructor(e){this.listeners=new Map,this.protectedChannels=["core","auth","api","analytics","interactions","pubsub","storage","ui","xr"],this.name=e}_remove(e,t){const n=this.listeners.get(e);n?this.listeners.set(e,[...n.filter((({callback:e})=>e!==t))]):Ye.warn(`No listeners for ${e}`)}dispatch(e,t,n,o){"string"==typeof e&&this.protectedChannels.indexOf(e)>-1&&(o===ze||Ye.warn(`WARNING: ${e} is protected and dispatching on it can have unintended consequences`));const i={channel:e,payload:{...t},source:n,patternInfo:[]};try{this._toListeners(i)}catch(e){Ye.error(e)}}listen(e,n,o="noname"){let i;if("function"!=typeof n)throw new t({name:"NoHubcallbackProvidedException",message:"No callback supplied to Hub"});i=n;let r=this.listeners.get(e);return r||(r=[],this.listeners.set(e,r)),r.push({name:o,callback:i}),()=>{this._remove(e,i)}}_toListeners(e){const{channel:t,payload:n}=e,o=this.listeners.get(t);o&&o.forEach((o=>{Ye.debug(`Dispatching to ${t} with `,n);try{o.callback(e)}catch(e){Ye.error(e)}}))}}new Ze("__default__");const Je=new Ze("internal-hub"),Qe={convert(e,{urlSafe:n}={urlSafe:!1}){const o="string"==typeof e?e:function(e){return Array.from(e,(e=>String.fromCodePoint(e))).join("")}(e),i=(()=>{if("undefined"!=typeof window&&"function"==typeof window.btoa)return window.btoa;if("function"==typeof btoa)return btoa;throw new t({name:"Base64EncoderError",message:"Cannot resolve the `btoa` function from the environment."})})()(o);return n?i.replace(/\+/g,"-").replace(/\//g,"_"):i}};function Xe(e,t){null!=e&&this.fromString(e,t)}function et(){return new Xe(null,null)}let tt;const nt="undefined"!=typeof navigator;nt&&"Microsoft Internet Explorer"===navigator.appName?(Xe.prototype.am=function(e,t,n,o,i,r){const s=32767&t,a=t>>15;for(;--r>=0;){let t=32767&this[e];const r=this[e++]>>15,c=a*t+r*s;t=s*t+((32767&c)<<15)+n[o]+(1073741823&i),i=(t>>>30)+(c>>>15)+a*r+(i>>>30),n[o++]=1073741823&t}return i},tt=30):nt&&"Netscape"!==navigator.appName?(Xe.prototype.am=function(e,t,n,o,i,r){for(;--r>=0;){const r=t*this[e++]+n[o]+i;i=Math.floor(r/67108864),n[o++]=67108863&r}return i},tt=26):(Xe.prototype.am=function(e,t,n,o,i,r){const s=16383&t,a=t>>14;for(;--r>=0;){let t=16383&this[e];const r=this[e++]>>14,c=a*t+r*s;t=s*t+((16383&c)<<14)+n[o]+i,i=(t>>28)+(c>>14)+a*r,n[o++]=268435455&t}return i},tt=28),Xe.prototype.DB=tt,Xe.prototype.DM=(1<<tt)-1,Xe.prototype.DV=1<<tt,Xe.prototype.FV=Math.pow(2,52),Xe.prototype.F1=52-tt,Xe.prototype.F2=2*tt-52;const ot=new Array;let it,rt;for(it="0".charCodeAt(0),rt=0;rt<=9;++rt)ot[it++]=rt;for(it="a".charCodeAt(0),rt=10;rt<36;++rt)ot[it++]=rt;for(it="A".charCodeAt(0),rt=10;rt<36;++rt)ot[it++]=rt;function st(e){return"0123456789abcdefghijklmnopqrstuvwxyz".charAt(e)}function at(e,t){var n=ot[e.charCodeAt(t)];return null==n?-1:n}function ct(e){var t=et();return t.fromInt(e),t}function ut(e){var t,n=1;return 0!=(t=e>>>16)&&(e=t,n+=16),0!=(t=e>>8)&&(e=t,n+=8),0!=(t=e>>4)&&(e=t,n+=4),0!=(t=e>>2)&&(e=t,n+=2),0!=(t=e>>1)&&(e=t,n+=1),n}function dt(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}dt.prototype.convert=function(e){var t=et();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(Xe.ZERO)>0&&this.m.subTo(t,t),t},dt.prototype.revert=function(e){var t=et();return e.copyTo(t),this.reduce(t),t},dt.prototype.reduce=function(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var n=32767&e[t],o=n*this.mpl+((n*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(e[n=t+this.m.t]+=this.m.am(0,o,e,t,0,this.m.t);e[n]>=e.DV;)e[n]-=e.DV,e[++n]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)},dt.prototype.mulTo=function(e,t,n){e.multiplyTo(t,n),this.reduce(n)},dt.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},Xe.prototype.copyTo=function(e){for(var t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t,e.s=this.s},Xe.prototype.fromInt=function(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0},Xe.prototype.fromString=function(e,t){let n;if(16===t)n=4;else if(8===t)n=3;else if(2===t)n=1;else if(32===t)n=5;else{if(4!==t)throw new Error("Only radix 2, 4, 8, 16, 32 are supported");n=2}this.t=0,this.s=0;let o=e.length,i=!1,r=0;for(;--o>=0;){const t=at(e,o);t<0?"-"===e.charAt(o)&&(i=!0):(i=!1,0===r?this[this.t++]=t:r+n>this.DB?(this[this.t-1]|=(t&(1<<this.DB-r)-1)<<r,this[this.t++]=t>>this.DB-r):this[this.t-1]|=t<<r,r+=n,r>=this.DB&&(r-=this.DB))}this.clamp(),i&&Xe.ZERO.subTo(this,this)},Xe.prototype.clamp=function(){for(var e=this.s&this.DM;this.t>0&&this[this.t-1]==e;)--this.t},Xe.prototype.dlShiftTo=function(e,t){let n;for(n=this.t-1;n>=0;--n)t[n+e]=this[n];for(n=e-1;n>=0;--n)t[n]=0;t.t=this.t+e,t.s=this.s},Xe.prototype.drShiftTo=function(e,t){for(let n=e;n<this.t;++n)t[n-e]=this[n];t.t=Math.max(this.t-e,0),t.s=this.s},Xe.prototype.lShiftTo=function(e,t){const n=e%this.DB,o=this.DB-n,i=(1<<o)-1;let r,s=Math.floor(e/this.DB),a=this.s<<n&this.DM;for(r=this.t-1;r>=0;--r)t[r+s+1]=this[r]>>o|a,a=(this[r]&i)<<n;for(r=s-1;r>=0;--r)t[r]=0;t[s]=a,t.t=this.t+s+1,t.s=this.s,t.clamp()},Xe.prototype.rShiftTo=function(e,t){t.s=this.s;const n=Math.floor(e/this.DB);if(n>=this.t)return void(t.t=0);const o=e%this.DB,i=this.DB-o,r=(1<<o)-1;t[0]=this[n]>>o;for(let e=n+1;e<this.t;++e)t[e-n-1]|=(this[e]&r)<<i,t[e-n]=this[e]>>o;o>0&&(t[this.t-n-1]|=(this.s&r)<<i),t.t=this.t-n,t.clamp()},Xe.prototype.subTo=function(e,t){let n=0,o=0,i=Math.min(e.t,this.t);for(;n<i;)o+=this[n]-e[n],t[n++]=o&this.DM,o>>=this.DB;if(e.t<this.t){for(o-=e.s;n<this.t;)o+=this[n],t[n++]=o&this.DM,o>>=this.DB;o+=this.s}else{for(o+=this.s;n<e.t;)o-=e[n],t[n++]=o&this.DM,o>>=this.DB;o-=e.s}t.s=o<0?-1:0,o<-1?t[n++]=this.DV+o:o>0&&(t[n++]=o),t.t=n,t.clamp()},Xe.prototype.multiplyTo=function(e,t){const n=this.abs(),o=e.abs();let i=n.t;for(t.t=i+o.t;--i>=0;)t[i]=0;for(i=0;i<o.t;++i)t[i+n.t]=n.am(0,o[i],t,i,0,n.t);t.s=0,t.clamp(),this.s!==e.s&&Xe.ZERO.subTo(t,t)},Xe.prototype.squareTo=function(e){for(var t=this.abs(),n=e.t=2*t.t;--n>=0;)e[n]=0;for(n=0;n<t.t-1;++n){var o=t.am(n,t[n],e,2*n,0,1);(e[n+t.t]+=t.am(n+1,2*t[n],e,2*n+1,o,t.t-n-1))>=t.DV&&(e[n+t.t]-=t.DV,e[n+t.t+1]=1)}e.t>0&&(e[e.t-1]+=t.am(n,t[n],e,2*n,0,1)),e.s=0,e.clamp()},Xe.prototype.divRemTo=function(e,t,n){var o=e.abs();if(o.t<=0)return;var i=this.abs();if(i.t<o.t)return null!=t&&t.fromInt(0),void(null!=n&&this.copyTo(n));null===n&&(n=et());var r=et(),s=this.s,a=e.s,c=this.DB-ut(o[o.t-1]);c>0?(o.lShiftTo(c,r),i.lShiftTo(c,n)):(o.copyTo(r),i.copyTo(n));const u=r.t,d=r[u-1];if(0===d)return;const l=d*(1<<this.F1)+(u>1?r[u-2]>>this.F2:0),p=this.FV/l,h=(1<<this.F1)/l,f=1<<this.F2;let g=n.t,E=g-u,m=null===t?et():t;for(r.dlShiftTo(E,m),n.compareTo(m)>=0&&(n[n.t++]=1,n.subTo(m,n)),Xe.ONE.dlShiftTo(u,m),m.subTo(r,r);r.t<u;)r[r.t++]=0;for(;--E>=0;){var y=n[--g]===d?this.DM:Math.floor(n[g]*p+(n[g-1]+f)*h);if((n[g]+=r.am(0,y,n,E,0,u))<y)for(r.dlShiftTo(E,m),n.subTo(m,n);n[g]<--y;)n.subTo(m,n)}null!==t&&(n.drShiftTo(u,t),s!==a&&Xe.ZERO.subTo(t,t)),n.t=u,n.clamp(),c>0&&n.rShiftTo(c,n),s<0&&Xe.ZERO.subTo(n,n)},Xe.prototype.invDigit=function(){if(this.t<1)return 0;var e=this[0];if(0==(1&e))return 0;var t=3&e;return(t=(t=(t=(t=t*(2-(15&e)*t)&15)*(2-(255&e)*t)&255)*(2-((65535&e)*t&65535))&65535)*(2-e*t%this.DV)%this.DV)>0?this.DV-t:-t},Xe.prototype.addTo=function(e,t){let n=0,o=0,i=Math.min(e.t,this.t);for(;n<i;)o+=this[n]+e[n],t[n++]=o&this.DM,o>>=this.DB;if(e.t<this.t){for(o+=e.s;n<this.t;)o+=this[n],t[n++]=o&this.DM,o>>=this.DB;o+=this.s}else{for(o+=this.s;n<e.t;)o+=e[n],t[n++]=o&this.DM,o>>=this.DB;o+=e.s}t.s=o<0?-1:0,o>0?t[n++]=o:o<-1&&(t[n++]=this.DV+o),t.t=n,t.clamp()},Xe.prototype.toString=function(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8===e)t=3;else if(2===e)t=1;else if(32===e)t=5;else{if(4!==e)throw new Error("Only radix 2, 4, 8, 16, 32 are supported");t=2}let n,o=(1<<t)-1,i=!1,r="",s=this.t,a=this.DB-s*this.DB%t;if(s-- >0)for(a<this.DB&&(n=this[s]>>a)>0&&(i=!0,r=st(n));s>=0;)a<t?(n=(this[s]&(1<<a)-1)<<t-a,n|=this[--s]>>(a+=this.DB-t)):(n=this[s]>>(a-=t)&o,a<=0&&(a+=this.DB,--s)),n>0&&(i=!0),i&&(r+=st(n));return i?r:"0"},Xe.prototype.negate=function(){var e=et();return Xe.ZERO.subTo(this,e),e},Xe.prototype.abs=function(){return this.s<0?this.negate():this},Xe.prototype.compareTo=function(e){var t=this.s-e.s;if(0!=t)return t;var n=this.t;if(0!=(t=n-e.t))return this.s<0?-t:t;for(;--n>=0;)if(0!=(t=this[n]-e[n]))return t;return 0},Xe.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+ut(this[this.t-1]^this.s&this.DM)},Xe.prototype.mod=function(e){var t=et();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(Xe.ZERO)>0&&e.subTo(t,t),t},Xe.prototype.equals=function(e){return 0===this.compareTo(e)},Xe.prototype.add=function(e){var t=et();return this.addTo(e,t),t},Xe.prototype.subtract=function(e){var t=et();return this.subTo(e,t),t},Xe.prototype.multiply=function(e){var t=et();return this.multiplyTo(e,t),t},Xe.prototype.divide=function(e){var t=et();return this.divRemTo(e,t,null),t},Xe.prototype.modPow=function(e,t,n){let o,i=e.bitLength(),r=ct(1),s=new dt(t);if(i<=0)return r;o=i<18?1:i<48?3:i<144?4:i<768?5:6;let a=new Array,c=3,u=o-1,d=(1<<o)-1;if(a[1]=s.convert(this),o>1){const e=et();for(s.sqrTo(a[1],e);c<=d;)a[c]=et(),s.mulTo(e,a[c-2],a[c]),c+=2}let l,p,h=e.t-1,f=!0,g=et();for(i=ut(e[h])-1;h>=0;){for(i>=u?l=e[h]>>i-u&d:(l=(e[h]&(1<<i+1)-1)<<u-i,h>0&&(l|=e[h-1]>>this.DB+i-u)),c=o;0==(1&l);)l>>=1,--c;if((i-=c)<0&&(i+=this.DB,--h),f)a[l].copyTo(r),f=!1;else{for(;c>1;)s.sqrTo(r,g),s.sqrTo(g,r),c-=2;c>0?s.sqrTo(r,g):(p=r,r=g,g=p),s.mulTo(g,a[l],r)}for(;h>=0&&0==(e[h]&1<<i);)s.sqrTo(r,g),p=r,r=g,g=p,--i<0&&(i=this.DB-1,--h)}var E=s.revert(r);return n(null,E),E},Xe.ZERO=ct(0),Xe.ONE=ct(1);const lt={convert:e=>(new TextEncoder).encode(e)},pt={},ht={};for(let e=0;e<256;e++){let t=e.toString(16).toLowerCase();1===t.length&&(t=`0${t}`),pt[e]=t,ht[t]=e}const ft=e=>{if(e.length%2!=0)throw new Error("Hex encoded strings must have an even number length");const t=new Uint8Array(e.length/2);for(let n=0;n<e.length;n+=2){const o=e.slice(n,n+2).toLowerCase();if(!(o in ht))throw new Error(`Cannot decode unrecognized sequence ${o} as hexadecimal`);t[n/2]=ht[o]}return t};var gt=o(387);const Et=e=>{let t="";for(let n=0;n<e.byteLength;n++)t+=pt[e[n]];return t},mt=e=>{const t=new gt.Sha256;t.update(e);const n=t.digestSync(),o=Et(n);return new Array(64-o.length).join("0")+o},yt=e=>mt(ft(e)),St=/^[89a-f]/i,xt=e=>{if(!(e instanceof Xe))throw new Error("Not a BigInteger");const t=e.compareTo(Xe.ZERO)<0;let n=e.abs().toString(16);if(n=n.length%2!=0?`0${n}`:n,n=St.test(n)?`00${n}`:n,t){const e=n.split("").map((e=>{const t=15&~parseInt(e,16);return"0123456789ABCDEF".charAt(t)})).join("");n=new Xe(e,16).add(Xe.ONE).toString(16),n.toUpperCase().startsWith("FF8")&&(n=n.substring(2))}return n};class It{constructor(e,t){this.words=[];let n=e;n=this.words=n||[],this.sigBytes=void 0!==t?t:4*n.length}random(e){const t=[];for(let n=0;n<e;n+=4)t.push(c().getRandomValues(new Uint32Array(1))[0]);return new It(t,e)}toString(){return function(e){const t=e.words,n=e.sigBytes,o=[];for(let e=0;e<n;e++){const n=t[e>>>2]>>>24-e%4*8&255;o.push((n>>>4).toString(16)),o.push((15&n).toString(16))}return o.join("")}(this)}}const wt=e=>{const t=(new It).random(e).toString();return ft(t)};class At{constructor({userPoolName:e,a:t,g:n,A:o,N:i}){this.encoder=lt,this.userPoolName=e,this.a=t,this.g=n,this.A=o,this.N=i,this.k=new Xe(yt(`${xt(i)}${xt(n)}`),16)}getRandomPassword(){if(!this.randomPassword)throw new de({name:"EmptyBigIntegerRandomPassword",message:"random password is empty"});return this.randomPassword}getSaltToHashDevices(){if(!this.saltToHashDevices)throw new de({name:"EmptyBigIntegersaltToHashDevices",message:"saltToHashDevices is empty"});return this.saltToHashDevices}getVerifierDevices(){if(!this.verifierDevices)throw new de({name:"EmptyBigIntegerVerifierDevices",message:"verifyDevices is empty"});return this.verifierDevices}async generateHashDevice(e,t){this.randomPassword=Qe.convert(wt(40));const n=`${e}${t}:${this.randomPassword}`,o=mt(n),i=Et(wt(16));return this.saltToHashDevices=xt(new Xe(i,16)),new Promise(((e,t)=>{this.g.modPow(new Xe(yt(this.saltToHashDevices+o),16),this.N,((n,o)=>{n?t(n):(this.verifierDevices=xt(o),e())}))}))}async getPasswordAuthenticationKey({username:e,password:t,serverBValue:n,salt:o}){if(n.mod(this.N).equals(Xe.ZERO))throw new Error("B cannot be zero.");const i=(({A:e,B:t})=>{const n=new Xe(yt(xt(e)+xt(t)),16);if(n.equals(Xe.ZERO))throw new Error("U cannot be zero.");return n})({A:this.A,B:n}),r=`${this.userPoolName}${e}:${t}`,s=mt(r),a=new Xe(yt(xt(o)+s),16),c=await(async({a:e,g:t,k:n,x:o,B:i,N:r,U:s})=>new Promise(((a,c)=>{t.modPow(o,r,((t,u)=>{t?c(t):i.subtract(n.multiply(u)).modPow(e.add(s.multiply(o)),r,((e,t)=>{e?c(e):a(t.mod(r))}))}))})))({a:this.a,g:this.g,k:this.k,x:a,B:n,N:this.N,U:i}),u=this.encoder.convert("Caldera Derived Key"),d=this.encoder.convert(String.fromCharCode(1)),l=new Uint8Array(u.byteLength+d.byteLength);l.set(u,0),l.set(d,u.byteLength);const p=((e,t,n)=>{const o=new gt.Sha256(t);o.update(e);const i=o.digestSync(),r=new gt.Sha256(i);return r.update(n),r.digestSync().slice(0,16)})(ft(xt(c)),ft(xt(i)),l);return p}}const vt=async e=>{const t=new Xe("FFFFFFFFFFFFFFFFC90FDAA22168C234C4C6628B80DC1CD129024E088A67CC74020BBEA63B139B22514A08798E3404DDEF9519B3CD3A431B302B0A6DF25F14374FE1356D6D51C245E485B576625E7EC6F44C42E9A637ED6B0BFF5CB6F406B7EDEE386BFB5A899FA5AE9F24117C4B1FE649286651ECE45B3DC2007CB8A163BF0598DA48361C55D39A69163FA8FD24CF5F83655D23DCA3AD961C62F356208552BB9ED529077096966D670C354E4ABC9804F1746C08CA18217C32905E462E36CE3BE39E772C180E86039B2783A2EC07A28FB5C55DF06F4C52C9DE2BCBF6955817183995497CEA956AE515D2261898FA051015728E5A8AAAC42DAD33170D04507A33A85521ABDF1CBA64ECFB850458DBEF0A8AEA71575D060C7DB3970F85A6E1E4C7ABF5AE8CDB0933D71E8C94E04A25619DCEE3D2261AD2EE6BF12FFA06D98A0864D87602733EC86A64521F2B18177B200CBBE117577A615D6C770988C0BAD946E208E24FA074E5AB3143DB5BFCE0FD108E4B82D120A93AD2CAFFFFFFFFFFFFFFFF",16),n=new Xe("2",16),o=Ct(),i=await(async({a:e,g:t,N:n})=>new Promise(((o,i)=>{t.modPow(e,n,((e,t)=>{e?i(e):t.mod(n).equals(Xe.ZERO)?i(new Error("Illegal parameter. A mod N cannot be 0.")):o(t)}))})))({a:o,g:n,N:t});return new At({userPoolName:e,a:o,g:n,A:i,N:t})},Ct=()=>new Xe(Et(wt(128)),16),Pt=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Rt=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Tt=()=>{const e=new Date,t=Rt[e.getUTCDay()],n=Pt[e.getUTCMonth()],o=e.getUTCDate();let i=e.getUTCHours();i<10&&(i=`0${i}`);let r=e.getUTCMinutes();r<10&&(r=`0${r}`);let s=e.getUTCSeconds();return s<10&&(s=`0${s}`),`${t} ${n} ${o} ${i}:${r}:${s} UTC ${e.getUTCFullYear()}`},Ut=({userPoolName:e,username:t,challengeParameters:n,dateNow:o,hkdf:i})=>{const r=lt.convert(e),s=lt.convert(t),a=Nt(n.SECRET_BLOCK),c=lt.convert(o),u=new Uint8Array(r.byteLength+s.byteLength+a.byteLength+c.byteLength);u.set(r,0),u.set(s,r.byteLength),u.set(a,r.byteLength+s.byteLength),u.set(c,r.byteLength+s.byteLength+a.byteLength);const d=new gt.Sha256(i);d.update(u);const l=d.digestSync();return Qe.convert(l)},Nt=e=>{const t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=u.convert(t),o=new Uint8Array(n.length);for(let e=0;e<n.length;++e)o[e]=n.charCodeAt(e);return o};var bt,_t,Dt,Mt,Ft,Ot,kt,Lt,Vt,Kt,Bt,qt,Gt,Ht,Wt,$t,jt,zt,Yt,Zt,Jt,Qt,Xt,en;!function(e){e.ConcurrentModificationException="ConcurrentModificationException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.NotAuthorizedException="NotAuthorizedException",e.ResourceNotFoundException="ResourceNotFoundException",e.SoftwareTokenMFANotFoundException="SoftwareTokenMFANotFoundException"}(bt||(bt={})),function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.InvalidPasswordException="InvalidPasswordException",e.LimitExceededException="LimitExceededException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"}(_t||(_t={})),function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.InvalidPasswordException="InvalidPasswordException",e.InvalidUserPoolConfigurationException="InvalidUserPoolConfigurationException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UsernameExistsException="UsernameExistsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"}(Dt||(Dt={})),function(e){e.CodeMismatchException="CodeMismatchException",e.ExpiredCodeException="ExpiredCodeException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.InvalidPasswordException="InvalidPasswordException",e.LimitExceededException="LimitExceededException",e.NotAuthorizedException="NotAuthorizedException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyFailedAttemptsException="TooManyFailedAttemptsException",e.TooManyRequestsException="TooManyRequestsException",e.UnexpectedLambdaException="UnexpectedLambdaException",e.UserLambdaValidationException="UserLambdaValidationException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"}(Mt||(Mt={})),function(e){e.AliasExistsException="AliasExistsException",e.CodeMismatchException="CodeMismatchException",e.ExpiredCodeException="ExpiredCodeException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.LimitExceededException="LimitExceededException",e.NotAuthorizedException="NotAuthorizedException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyFailedAttemptsException="TooManyFailedAttemptsException",e.TooManyRequestsException="TooManyRequestsException",e.UnexpectedLambdaException="UnexpectedLambdaException",e.UserLambdaValidationException="UserLambdaValidationException",e.UserNotFoundException="UserNotFoundException"}(Ft||(Ft={})),function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"}(Ot||(Ot={})),function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"}(kt||(kt={})),function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.InvalidUserPoolConfigurationException="InvalidUserPoolConfigurationException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"}(Lt||(Lt={})),function(e){e.CodeDeliveryFailureException="CodeDeliveryFailureException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidEmailRoleAccessPolicyException="InvalidEmailRoleAccessPolicyException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.InvalidSmsRoleAccessPolicyException="InvalidSmsRoleAccessPolicyException",e.InvalidSmsRoleTrustRelationshipException="InvalidSmsRoleTrustRelationshipException",e.LimitExceededException="LimitExceededException",e.NotAuthorizedException="NotAuthorizedException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UnexpectedLambdaException="UnexpectedLambdaException",e.UserLambdaValidationException="UserLambdaValidationException",e.UserNotFoundException="UserNotFoundException"}(Vt||(Vt={})),function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"}(Kt||(Kt={})),function(e){e.ExternalServiceException="ExternalServiceException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.LimitExceededException="LimitExceededException",e.NotAuthorizedException="NotAuthorizedException",e.ResourceConflictException="ResourceConflictException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException"}(Bt||(Bt={})),function(e){e.ExternalServiceException="ExternalServiceException",e.InternalErrorException="InternalErrorException",e.InvalidIdentityPoolConfigurationException="InvalidIdentityPoolConfigurationException",e.InvalidParameterException="InvalidParameterException",e.NotAuthorizedException="NotAuthorizedException",e.ResourceConflictException="ResourceConflictException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException"}(qt||(qt={})),function(e){e.CodeDeliveryFailureException="CodeDeliveryFailureException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidEmailRoleAccessPolicyException="InvalidEmailRoleAccessPolicyException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.InvalidSmsRoleAccessPolicyException="InvalidSmsRoleAccessPolicyException",e.InvalidSmsRoleTrustRelationshipException="InvalidSmsRoleTrustRelationshipException",e.LimitExceededException="LimitExceededException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UnexpectedLambdaException="UnexpectedLambdaException",e.UserLambdaValidationException="UserLambdaValidationException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"}(Gt||(Gt={})),function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException"}(Ht||(Ht={})),function(e){e.PasswordResetRequiredException="PasswordResetRequiredException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.InvalidSmsRoleAccessPolicyException="InvalidSmsRoleAccessPolicyException",e.InvalidSmsRoleTrustRelationshipException="InvalidSmsRoleTrustRelationshipException",e.InvalidUserPoolConfigurationException="InvalidUserPoolConfigurationException",e.NotAuthorizedException="NotAuthorizedException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UnexpectedLambdaException="UnexpectedLambdaException",e.UserLambdaValidationException="UserLambdaValidationException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"}(Wt||(Wt={})),function(e){e.CodeDeliveryFailureException="CodeDeliveryFailureException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidEmailRoleAccessPolicyException="InvalidEmailRoleAccessPolicyException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.InvalidSmsRoleAccessPolicyException="InvalidSmsRoleAccessPolicyException",e.InvalidSmsRoleTrustRelationshipException="InvalidSmsRoleTrustRelationshipException",e.LimitExceededException="LimitExceededException",e.NotAuthorizedException="NotAuthorizedException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UnexpectedLambdaException="UnexpectedLambdaException",e.UserLambdaValidationException="UserLambdaValidationException",e.UserNotFoundException="UserNotFoundException"}($t||($t={})),function(e){e.AliasExistsException="AliasExistsException",e.CodeMismatchException="CodeMismatchException",e.ExpiredCodeException="ExpiredCodeException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.InvalidPasswordException="InvalidPasswordException",e.InvalidSmsRoleAccessPolicyException="InvalidSmsRoleAccessPolicyException",e.InvalidSmsRoleTrustRelationshipException="InvalidSmsRoleTrustRelationshipException",e.InvalidUserPoolConfigurationException="InvalidUserPoolConfigurationException",e.MFAMethodNotFoundException="MFAMethodNotFoundException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.SoftwareTokenMFANotFoundException="SoftwareTokenMFANotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UnexpectedLambdaException="UnexpectedLambdaException",e.UserLambdaValidationException="UserLambdaValidationException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"}(jt||(jt={})),function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"}(zt||(zt={})),function(e){e.CodeDeliveryFailureException="CodeDeliveryFailureException",e.InternalErrorException="InternalErrorException",e.InvalidEmailRoleAccessPolicyException="InvalidEmailRoleAccessPolicyException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.InvalidPasswordException="InvalidPasswordException",e.InvalidSmsRoleAccessPolicyException="InvalidSmsRoleAccessPolicyException",e.InvalidSmsRoleTrustRelationshipException="InvalidSmsRoleTrustRelationshipException",e.NotAuthorizedException="NotAuthorizedException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UnexpectedLambdaException="UnexpectedLambdaException",e.UserLambdaValidationException="UserLambdaValidationException",e.UsernameExistsException="UsernameExistsException"}(Yt||(Yt={})),function(e){e.AliasExistsException="AliasExistsException",e.CodeDeliveryFailureException="CodeDeliveryFailureException",e.CodeMismatchException="CodeMismatchException",e.ExpiredCodeException="ExpiredCodeException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidEmailRoleAccessPolicyException="InvalidEmailRoleAccessPolicyException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.InvalidSmsRoleAccessPolicyException="InvalidSmsRoleAccessPolicyException",e.InvalidSmsRoleTrustRelationshipException="InvalidSmsRoleTrustRelationshipException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UnexpectedLambdaException="UnexpectedLambdaException",e.UserLambdaValidationException="UserLambdaValidationException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"}(Zt||(Zt={})),function(e){e.CodeMismatchException="CodeMismatchException",e.EnableSoftwareTokenMFAException="EnableSoftwareTokenMFAException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.InvalidUserPoolConfigurationException="InvalidUserPoolConfigurationException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.SoftwareTokenMFANotFoundException="SoftwareTokenMFANotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"}(Jt||(Jt={})),function(e){e.AliasExistsException="AliasExistsException",e.CodeMismatchException="CodeMismatchException",e.ExpiredCodeException="ExpiredCodeException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.LimitExceededException="LimitExceededException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"}(Qt||(Qt={})),function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.InvalidUserPoolConfigurationException="InvalidUserPoolConfigurationException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"}(Xt||(Xt={})),function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.InvalidUserPoolConfigurationException="InvalidUserPoolConfigurationException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"}(en||(en={}));const tn="SetUpTOTPException";const nn=(e=>{let t=e({username:void 0,challengeName:void 0,signInSession:void 0},{type:"SET_INITIAL_STATE"});return{getState:()=>t,dispatch:n=>{t=e(t,n)}}})(((e,t)=>{switch(t.type){case"SET_SIGN_IN_SESSION":return{...e,signInSession:t.value};case"SET_SIGN_IN_STATE":return{...t.value};case"SET_CHALLENGE_NAME":return{...e,challengeName:t.value};case"SET_USERNAME":return{...e,username:t.value};case"SET_INITIAL_STATE":return{username:void 0,challengeName:void 0,signInSession:void 0};default:return e}}));function on(e){nn.dispatch({type:"SET_SIGN_IN_STATE",value:e})}function rn(){nn.dispatch({type:"SET_INITIAL_STATE"})}const sn="UserUnAuthenticatedException",an="UserAlreadyAuthenticatedException",cn="DeviceMetadataNotFoundException",un="AutoSignInException",dn=(new de({name:"InvalidRedirectException",message:"signInRedirect or signOutRedirect had an invalid format or was not found.",recoverySuggestion:"Please make sure the signIn/Out redirect in your oauth config is valid."}),new de({name:"InvalidOriginException",message:"redirect is coming from a different origin. The oauth flow needs to be initiated from the same origin",recoverySuggestion:"Please call signInWithRedirect from the same origin."}),"OAuthSignOutException");function ln(e){if(!e||!e.accessToken)throw new de({name:sn,message:"User needs to be authenticated to call this API.",recoverySuggestion:"Sign in before calling this API again."})}const pn=new de({name:"TokenRefreshException",message:"Token refresh is not supported when authenticated with the 'implicit grant' (token) oauth flow. \n\tPlease change your oauth configuration to use 'code grant' flow.",recoverySuggestion:"Please logout and change your Amplify configuration to use \"code grant\" flow. \n\tE.g { responseType: 'code' }"}),hn=new de({name:sn,message:"User needs to be authenticated to call this API.",recoverySuggestion:"Sign in before calling this API again."});function fn(e){if(function(e){return mn(e)&&!e?.refreshToken}(e))throw pn;if(!function(e){return mn(e)&&e?.refreshToken}(e))throw hn}function gn(e){if(!(e&&e.deviceKey&&e.deviceGroupKey&&e.randomPassword))throw new de({name:cn,message:"Either deviceKey, deviceGroupKey or secretPassword were not found during the sign-in process.",recoverySuggestion:"Make sure to not clear storage after calling the signIn API."})}const En={inflightOAuth:"inflightOAuth",oauthSignIn:"oauthSignIn",oauthPKCE:"oauthPKCE",oauthState:"oauthState"};function mn(e){return e?.accessToken||e?.idToken}const yn=async()=>(async e=>{const t=e.getConfig().Auth?.Cognito;d(t);const n=await e.Auth.getTokens({forceRefresh:!1});ln(n);const{"cognito:username":o,sub:i}=n.idToken?.payload??{},r={username:o,userId:i},s=function(e){return e?.signInDetails}(n);return s&&(r.signInDetails=s),r})(e.Amplify),Sn=(e,t)=>ie({category:f.Auth,action:e,...t});function xn({username:e,userPoolId:t,userPoolClientId:n}){if("undefined"==typeof window)return;const o=window.AmazonCognitoAdvancedSecurityData;if(void 0===o)return;const i=o.getData(e,t,n);return i?{EncodedData:i}:{}}const In="userAttributes.";async function wn({challengeResponse:e,clientMetadata:t,session:n,username:o,config:i,tokenOrchestrator:r}){const{userPoolId:s,userPoolClientId:a}=i,c={USERNAME:o,ANSWER:e},u=await(r?.getDeviceMetadata(o));u&&u.deviceKey&&(c.DEVICE_KEY=u.deviceKey);const d={ChallengeName:"CUSTOM_CHALLENGE",ChallengeResponses:c,Session:n,ClientMetadata:t,ClientId:a,UserContextData:xn({username:o,userPoolId:s,userPoolClientId:a})},l=await Ie({region:He(s),userAgentValue:Sn(m.ConfirmSignIn)},d);return"DEVICE_SRP_AUTH"===l.ChallengeName?Cn({username:o,config:i,clientMetadata:t,session:l.Session,tokenOrchestrator:r}):l}async function An(e,t,n,o,i){const{userPoolClientId:r,userPoolId:s}=o,a={USERNAME:e,PASSWORD:t},c=await i.getDeviceMetadata(e);c&&c.deviceKey&&(a.DEVICE_KEY=c.deviceKey);const u={AuthFlow:"USER_PASSWORD_AUTH",AuthParameters:a,ClientMetadata:n,ClientId:r,UserContextData:xn({username:e,userPoolId:s,userPoolClientId:r})},d=await ge({region:He(s),userAgentValue:Sn(m.SignIn)},u),l=d.ChallengeParameters?.USERNAME??d.ChallengeParameters?.USER_ID_FOR_SRP??e;return Vn(l),"DEVICE_SRP_AUTH"===d.ChallengeName?Cn({username:l,config:o,clientMetadata:n,session:d.Session,tokenOrchestrator:i}):d}async function vn(e,t,n,o){const{userPoolClientId:i,userPoolId:r}=n,s={USERNAME:e},a=await o.getDeviceMetadata(e);a&&a.deviceKey&&(s.DEVICE_KEY=a.deviceKey);const c={AuthFlow:"CUSTOM_AUTH",AuthParameters:s,ClientMetadata:t,ClientId:i,UserContextData:xn({username:e,userPoolId:r,userPoolClientId:i})},u=await ge({region:He(r),userAgentValue:Sn(m.SignIn)},c),d=u.ChallengeParameters?.USERNAME??e;return Vn(d),"DEVICE_SRP_AUTH"===u.ChallengeName?Cn({username:d,config:n,clientMetadata:t,session:u.Session,tokenOrchestrator:o}):u}async function Cn({username:e,config:t,clientMetadata:n,session:o,tokenOrchestrator:i}){const r=t.userPoolId,s=t.userPoolClientId,a=await(i?.getDeviceMetadata(e));gn(a);const c=await vt(a.deviceGroupKey),u={ChallengeName:"DEVICE_SRP_AUTH",ClientId:s,ChallengeResponses:{USERNAME:e,SRP_A:c.A.toString(16),DEVICE_KEY:a.deviceKey},ClientMetadata:n,Session:o},{ChallengeParameters:d,Session:l}=await Ie({region:He(r)},u);return async function(e,t,n,o,i,{userPoolId:r,userPoolClientId:s},a){const c=await(a?.getDeviceMetadata(e));gn(c);const u=new Xe(t?.SRP_B,16),d=new Xe(t?.SALT,16),l=c.deviceKey,p=c.deviceGroupKey,h=await i.getPasswordAuthenticationKey({username:c.deviceKey,password:c.randomPassword,serverBValue:u,salt:d}),f=Tt(),g={ChallengeName:"DEVICE_PASSWORD_VERIFIER",ClientId:s,ChallengeResponses:{USERNAME:t?.USERNAME??e,PASSWORD_CLAIM_SECRET_BLOCK:t?.SECRET_BLOCK,TIMESTAMP:f,PASSWORD_CLAIM_SIGNATURE:Ut({username:l,userPoolName:p,challengeParameters:t,dateNow:f,hkdf:h}),DEVICE_KEY:l},Session:o,ClientMetadata:n,UserContextData:xn({username:e,userPoolId:r,userPoolClientId:s})};return Ie({region:He(r)},g)}(e,d,n,l,c,t,i)}async function Pn(e,t,n,o,i,r,s){const{userPoolId:a,userPoolClientId:c}=r,u=a?.split("_")[1]||"",d=new Xe(t?.SRP_B,16),l=new Xe(t?.SALT,16),p=t?.USER_ID_FOR_SRP;if(!p)throw new de({name:"EmptyUserIdForSRPException",message:"USER_ID_FOR_SRP was not found in challengeParameters"});const h=await i.getPasswordAuthenticationKey({username:p,password:e,serverBValue:d,salt:l}),f=Tt(),g={USERNAME:p,PASSWORD_CLAIM_SECRET_BLOCK:t?.SECRET_BLOCK,TIMESTAMP:f,PASSWORD_CLAIM_SIGNATURE:Ut({username:p,userPoolName:u,challengeParameters:t,dateNow:f,hkdf:h})},E=await s.getDeviceMetadata(p);E&&E.deviceKey&&(g.DEVICE_KEY=E.deviceKey);const m={ChallengeName:"PASSWORD_VERIFIER",ChallengeResponses:g,ClientMetadata:n,Session:o,ClientId:c,UserContextData:xn({username:p,userPoolId:a,userPoolClientId:c})},y=await Ie({region:He(a)},m);return"DEVICE_SRP_AUTH"===y.ChallengeName?Cn({username:p,config:r,clientMetadata:n,session:y.Session,tokenOrchestrator:s}):y}async function Rn(t){const{challengeName:n,challengeParameters:o}=t,i=e.Amplify.getConfig().Auth?.Cognito;switch(d(i),n){case"CUSTOM_CHALLENGE":return{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_IN_WITH_CUSTOM_CHALLENGE",additionalInfo:o}};case"MFA_SETUP":const{signInSession:e,username:t}=nn.getState();if(!function(e,t){const{MFAS_CAN_SETUP:n}=e,o=Mn(Fn(n));return!!o&&o.includes("TOTP")}(o))throw new de({name:Be.SignInException,message:`Cannot initiate MFA setup from available types: ${Mn(Fn(o.MFAS_CAN_SETUP))}`});const{Session:n,SecretCode:r}=await ve({region:He(i.userPoolId)},{Session:e});return nn.dispatch({type:"SET_SIGN_IN_SESSION",value:n}),{isSignedIn:!1,nextStep:{signInStep:"CONTINUE_SIGN_IN_WITH_TOTP_SETUP",totpSetupDetails:Tn(r,t)}};case"NEW_PASSWORD_REQUIRED":return{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_IN_WITH_NEW_PASSWORD_REQUIRED",missingAttributes:Nn(o.requiredAttributes)}};case"SELECT_MFA_TYPE":return{isSignedIn:!1,nextStep:{signInStep:"CONTINUE_SIGN_IN_WITH_MFA_SELECTION",allowedMFATypes:Mn(Fn(o.MFAS_CAN_CHOOSE))}};case"SMS_MFA":return{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_IN_WITH_SMS_CODE",codeDeliveryDetails:{deliveryMedium:o.CODE_DELIVERY_DELIVERY_MEDIUM,destination:o.CODE_DELIVERY_DESTINATION}}};case"SOFTWARE_TOKEN_MFA":return{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_IN_WITH_TOTP_CODE"}}}throw new de({name:Be.SignInException,message:`An error occurred during the sign in process. ${n} challengeName returned by the underlying service was not addressed.`})}function Tn(e,t){return{sharedSecret:e,getSetupUri:(n,o)=>new G(`otpauth://totp/${n}:${o??t}?secret=${e}&issuer=${n}`)}}function Un(e){return e===Wt.PasswordResetRequiredException?{isSignedIn:!1,nextStep:{signInStep:"RESET_PASSWORD"}}:e===Wt.UserNotConfirmedException?{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_UP"}}:void 0}function Nn(e){return e?JSON.parse(e).map((e=>e.includes(In)?e.replace(In,""):e)):[]}function bn(e){if(!e)return{};const t={};return Object.entries(e).forEach((([e,n])=>{n&&(t[`${In}${e}`]=n)})),t}function _n(e){let t="SMS_MFA";return"TOTP"===e&&(t="SOFTWARE_TOKEN_MFA"),t}function Dn(e){return"SMS_MFA"===e?"SMS":"SOFTWARE_TOKEN_MFA"===e?"TOTP":void 0}function Mn(e){if(e)return e.map(Dn).filter(Boolean)}function Fn(e){return e?JSON.parse(e):[]}async function On(){let e;try{e=await yn()}catch(e){}if(e&&e.userId&&e.username)throw new de({name:an,message:"There is already a signed in user.",recoverySuggestion:"Call signOut before calling signIn again."})}async function kn(e,t,n){if(!t)return;const o=e.split("_")[1]||"",i=await vt(o),r=t?.DeviceKey,s=t?.DeviceGroupKey;try{await i.generateHashDevice(s??"",r??"")}catch(e){return}const a={Salt:Qe.convert(ft(i.getSaltToHashDevices())),PasswordVerifier:Qe.convert(ft(i.getVerifierDevices()))},c=i.getRandomPassword();try{return await Te({region:He(e)},{AccessToken:n,DeviceKey:t?.DeviceKey,DeviceSecretVerifierConfig:a}),{deviceKey:r,deviceGroupKey:s,randomPassword:c}}catch(e){return}}async function Ln(e,t,n,o){try{return await e(...t)}catch(i){if(i instanceof de&&"ResourceNotFoundException"===i.name&&i.message.includes("Device does not exist."))return await o.clearDeviceMetadata(n),await e(...t);throw i}}function Vn(e){const{dispatch:t}=nn;t({type:"SET_USERNAME",value:e})}function Kn(e){return nn.getState().username??e}const Bn=async({tokens:e,authConfig:t,username:n})=>{d(t?.Cognito);const o=He(t.Cognito.userPoolId);fn(e);const i=e.refreshToken,r={REFRESH_TOKEN:i};e.deviceMetadata?.deviceKey&&(r.DEVICE_KEY=e.deviceMetadata.deviceKey);const s=xn({username:n,userPoolId:t.Cognito.userPoolId,userPoolClientId:t.Cognito.userPoolClientId}),{AuthenticationResult:a}=await ge({region:o},{ClientId:t?.Cognito?.userPoolClientId,AuthFlow:"REFRESH_TOKEN_AUTH",AuthParameters:r,UserContextData:s}),c=p(a?.AccessToken??""),u=a?.IdToken?p(a.IdToken):void 0,l=c.payload.iat;if(!l)throw new de({name:"iatNotFoundException",message:"iat not found in access token"});return{accessToken:c,idToken:u,clockDrift:1e3*l-(new Date).getTime(),refreshToken:i,username:n}},qn={accessToken:"accessToken",idToken:"idToken",oidcProvider:"oidcProvider",clockDrift:"clockDrift",refreshToken:"refreshToken",deviceKey:"deviceKey",randomPasswordKey:"randomPasswordKey",deviceGroupKey:"deviceGroupKey",signInDetails:"signInDetails"};var Gn;!function(e){e.InvalidAuthTokens="InvalidAuthTokens"}(Gn||(Gn={}));const Hn=n({[Gn.InvalidAuthTokens]:{message:"Invalid tokens.",recoverySuggestion:"Make sure the tokens are valid."}});class Wn{constructor(){this.name="CognitoIdentityServiceProvider"}getKeyValueStorage(){if(!this.keyValueStorage)throw new de({name:"KeyValueStorageNotFoundException",message:"KeyValueStorage was not found in TokenStore"});return this.keyValueStorage}setKeyValueStorage(e){this.keyValueStorage=e}setAuthConfig(e){this.authConfig=e}async loadTokens(){try{const e=await this.getAuthKeys(),t=await this.getKeyValueStorage().getItem(e.accessToken);if(!t)throw new de({name:"NoSessionFoundException",message:"Auth session was not found. Make sure to call signIn."});const n=p(t),o=await this.getKeyValueStorage().getItem(e.idToken),i=o?p(o):void 0,r=await this.getKeyValueStorage().getItem(e.refreshToken)??void 0,s=await this.getKeyValueStorage().getItem(e.clockDrift)??"0",a=Number.parseInt(s),c=await this.getKeyValueStorage().getItem(e.signInDetails),u={accessToken:n,idToken:i,refreshToken:r,deviceMetadata:await this.getDeviceMetadata()??void 0,clockDrift:a,username:await this.getLastAuthUser()};return c&&(u.signInDetails=JSON.parse(c)),u}catch(e){return null}}async storeTokens(e){Hn(void 0!==e,Gn.InvalidAuthTokens),await this.clearTokens();const t=e.username;await this.getKeyValueStorage().setItem(this.getLastAuthUserKey(),t);const n=await this.getAuthKeys();await this.getKeyValueStorage().setItem(n.accessToken,e.accessToken.toString()),e.idToken&&await this.getKeyValueStorage().setItem(n.idToken,e.idToken.toString()),e.refreshToken&&await this.getKeyValueStorage().setItem(n.refreshToken,e.refreshToken),e.deviceMetadata&&(e.deviceMetadata.deviceKey&&await this.getKeyValueStorage().setItem(n.deviceKey,e.deviceMetadata.deviceKey),e.deviceMetadata.deviceGroupKey&&await this.getKeyValueStorage().setItem(n.deviceGroupKey,e.deviceMetadata.deviceGroupKey),await this.getKeyValueStorage().setItem(n.randomPasswordKey,e.deviceMetadata.randomPassword)),e.signInDetails&&await this.getKeyValueStorage().setItem(n.signInDetails,JSON.stringify(e.signInDetails)),await this.getKeyValueStorage().setItem(n.clockDrift,`${e.clockDrift}`)}async clearTokens(){const e=await this.getAuthKeys();await Promise.all([this.getKeyValueStorage().removeItem(e.accessToken),this.getKeyValueStorage().removeItem(e.idToken),this.getKeyValueStorage().removeItem(e.clockDrift),this.getKeyValueStorage().removeItem(e.refreshToken),this.getKeyValueStorage().removeItem(e.signInDetails),this.getKeyValueStorage().removeItem(this.getLastAuthUserKey())])}async getDeviceMetadata(e){const t=await this.getAuthKeys(e),n=await this.getKeyValueStorage().getItem(t.deviceKey),o=await this.getKeyValueStorage().getItem(t.deviceGroupKey),i=await this.getKeyValueStorage().getItem(t.randomPasswordKey);return i?{deviceKey:n??void 0,deviceGroupKey:o??void 0,randomPassword:i}:null}async clearDeviceMetadata(e){const t=await this.getAuthKeys(e);await Promise.all([this.getKeyValueStorage().removeItem(t.deviceKey),this.getKeyValueStorage().removeItem(t.deviceGroupKey),this.getKeyValueStorage().removeItem(t.randomPasswordKey)])}async getAuthKeys(e){d(this.authConfig?.Cognito);const t=e??await this.getLastAuthUser();return $n(this.name,`${this.authConfig.Cognito.userPoolClientId}.${t}`)}getLastAuthUserKey(){d(this.authConfig?.Cognito);const e=this.authConfig.Cognito.userPoolClientId;return`${this.name}.${e}.LastAuthUser`}async getLastAuthUser(){return await this.getKeyValueStorage().getItem(this.getLastAuthUserKey())??"username"}}const $n=(e,t)=>jn(qn)(`${e}`,t);function jn(e){const t=Object.values({...e});return(e,n)=>t.reduce(((t,o)=>({...t,[o]:`${e}.${n}.${o}`})),{})}function zn({expiresAt:e,clockDrift:t}){return Date.now()+t>e}class Yn{constructor(){this.waitForInflightOAuth=async()=>{}}setAuthConfig(e){this.authConfig=e}setTokenRefresher(e){this.tokenRefresher=e}setAuthTokenStore(e){this.tokenStore=e}setWaitForInflightOAuth(e){this.waitForInflightOAuth=e}getTokenStore(){if(!this.tokenStore)throw new de({name:"EmptyTokenStoreException",message:"TokenStore not set"});return this.tokenStore}getTokenRefresher(){if(!this.tokenRefresher)throw new de({name:"EmptyTokenRefresherException",message:"TokenRefresher not set"});return this.tokenRefresher}async getTokens(e){let t;try{d(this.authConfig?.Cognito)}catch(e){return null}await this.waitForInflightOAuth(),t=await this.getTokenStore().loadTokens();const n=await this.getTokenStore().getLastAuthUser();if(null===t)return null;const o=!!t?.idToken&&zn({expiresAt:1e3*(t.idToken?.payload?.exp??0),clockDrift:t.clockDrift??0}),i=zn({expiresAt:1e3*(t.accessToken?.payload?.exp??0),clockDrift:t.clockDrift??0});return(e?.forceRefresh||o||i)&&(t=await this.refreshTokens({tokens:t,username:n}),null===t)?null:{accessToken:t?.accessToken,idToken:t?.idToken,signInDetails:t?.signInDetails}}async refreshTokens({tokens:t,username:n}){try{const o=await this.getTokenRefresher()({tokens:t,authConfig:this.authConfig,username:n});return await this.setTokens({tokens:o}),e.Hub.dispatch("auth",{event:"tokenRefresh"},"Auth",ze),o}catch(e){return this.handleErrors(e)}}handleErrors(t){if(le(t),"Network error"!==t.message&&this.clearTokens(),e.Hub.dispatch("auth",{event:"tokenRefresh_failure",data:{error:t}},"Auth",ze),t.name.startsWith("NotAuthorizedException"))return null;throw t}async setTokens({tokens:e}){return this.getTokenStore().storeTokens(e)}async clearTokens(){return this.getTokenStore().clearTokens()}getDeviceMetadata(e){return this.getTokenStore().getDeviceMetadata(e)}clearDeviceMetadata(e){return this.getTokenStore().clearDeviceMetadata(e)}}const Zn=new class{constructor(){this.authTokenStore=new Wn,this.authTokenStore.setKeyValueStorage(e.defaultStorage),this.tokenOrchestrator=new Yn,this.tokenOrchestrator.setAuthTokenStore(this.authTokenStore),this.tokenOrchestrator.setTokenRefresher(Bn)}getTokens({forceRefresh:e}={forceRefresh:!1}){return this.tokenOrchestrator.getTokens({forceRefresh:e})}setKeyValueStorage(e){this.authTokenStore.setKeyValueStorage(e)}setWaitForInflightOAuth(e){this.tokenOrchestrator.setWaitForInflightOAuth(e)}setAuthConfig(e){this.authTokenStore.setAuthConfig(e),this.tokenOrchestrator.setAuthConfig(e)}},Jn=Zn.tokenOrchestrator;async function Qn(e){if(!e.AccessToken)throw new t({message:"Invalid tokens",name:"InvalidTokens",recoverySuggestion:"Check Cognito UserPool settings"});{const t=p(e.AccessToken),n=1e3*(t.payload.iat||0),o=(new Date).getTime(),i=n>0?n-o:0;let r,s,a;e.RefreshToken&&(s=e.RefreshToken),e.IdToken&&(r=p(e.IdToken)),e?.NewDeviceMetadata&&(a=e.NewDeviceMetadata);const c={accessToken:t,idToken:r,refreshToken:s,clockDrift:i,deviceMetadata:a,username:e.username};e?.signInDetails&&(c.signInDetails=e.signInDetails),await Jn.setTokens({tokens:c})}}async function Xn(t){const n=t.options?.authFlowType;switch(await On(),n){case"USER_SRP_AUTH":default:return async function(t){const{username:n,password:o}=t,i=e.Amplify.getConfig().Auth?.Cognito,r={loginId:n,authFlowType:"USER_SRP_AUTH"};d(i);const s=t.options?.clientMetadata;Ge(!!n,Le.EmptySignInUsername),Ge(!!o,Le.EmptySignInPassword);try{const{ChallengeName:t,ChallengeParameters:a,AuthenticationResult:c,Session:u}=await async function(e,t,n,o,i){const{userPoolId:r,userPoolClientId:s}=o,a=r?.split("_")[1]||"",c=await vt(a),u={AuthFlow:"USER_SRP_AUTH",AuthParameters:{USERNAME:e,SRP_A:c.A.toString(16)},ClientMetadata:n,ClientId:s,UserContextData:xn({username:e,userPoolId:r,userPoolClientId:s})},d=await ge({region:He(r),userAgentValue:Sn(m.SignIn)},u),{ChallengeParameters:l,Session:p}=d,h=l?.USERNAME??e;return Vn(h),Ln(Pn,[t,l,n,p,c,o,i],h,i)}(n,o,s,i,Jn),d=Kn(n);return on({signInSession:u,username:d,challengeName:t,signInDetails:r}),c?(rn(),await Qn({username:d,...c,NewDeviceMetadata:await kn(i.userPoolId,c.NewDeviceMetadata,c.AccessToken),signInDetails:r}),e.Hub.dispatch("auth",{event:"signedIn",data:await yn()},"Auth",ze),{isSignedIn:!0,nextStep:{signInStep:"DONE"}}):Rn({challengeName:t,challengeParameters:a})}catch(e){rn(),le(e);const t=Un(e.name);if(t)return t;throw e}}(t);case"USER_PASSWORD_AUTH":return async function(t){const{username:n,password:o,options:i}=t,r=e.Amplify.getConfig().Auth?.Cognito,s={loginId:n,authFlowType:"USER_PASSWORD_AUTH"};d(r);const a=i?.clientMetadata;Ge(!!n,Le.EmptySignInUsername),Ge(!!o,Le.EmptySignInPassword);try{const{ChallengeName:t,ChallengeParameters:i,AuthenticationResult:c,Session:u}=await Ln(An,[n,o,a,r,Jn],n,Jn),d=Kn(n);return on({signInSession:u,username:d,challengeName:t,signInDetails:s}),c?(await Qn({...c,username:d,NewDeviceMetadata:await kn(r.userPoolId,c.NewDeviceMetadata,c.AccessToken),signInDetails:s}),rn(),e.Hub.dispatch("auth",{event:"signedIn",data:await yn()},"Auth",ze),{isSignedIn:!0,nextStep:{signInStep:"DONE"}}):Rn({challengeName:t,challengeParameters:i})}catch(e){rn(),le(e);const t=Un(e.name);if(t)return t;throw e}}(t);case"CUSTOM_WITHOUT_SRP":return async function(t){const n=e.Amplify.getConfig().Auth?.Cognito;d(n);const{username:o,password:i,options:r}=t,s={loginId:o,authFlowType:"CUSTOM_WITHOUT_SRP"},a=r?.clientMetadata;Ge(!!o,Le.EmptySignInUsername),Ge(!i,Le.CustomAuthSignInPassword);try{const{ChallengeName:t,ChallengeParameters:i,AuthenticationResult:r,Session:c}=await Ln(vn,[o,a,n,Jn],o,Jn),u=Kn(o);return on({signInSession:c,username:u,challengeName:t,signInDetails:s}),r?(rn(),await Qn({username:u,...r,NewDeviceMetadata:await kn(n.userPoolId,r.NewDeviceMetadata,r.AccessToken),signInDetails:s}),e.Hub.dispatch("auth",{event:"signedIn",data:await yn()},"Auth",ze),{isSignedIn:!0,nextStep:{signInStep:"DONE"}}):Rn({challengeName:t,challengeParameters:i})}catch(e){rn(),le(e);const t=Un(e.name);if(t)return t;throw e}}(t);case"CUSTOM_WITH_SRP":return async function(t){const{username:n,password:o,options:i}=t,r={loginId:n,authFlowType:"CUSTOM_WITH_SRP"},s=e.Amplify.getConfig().Auth?.Cognito;d(s);const a=i?.clientMetadata;Ge(!!n,Le.EmptySignInUsername),Ge(!!o,Le.EmptySignInPassword);try{const{ChallengeName:t,ChallengeParameters:i,AuthenticationResult:c,Session:u}=await async function(e,t,n,o,i){d(o);const{userPoolId:r,userPoolClientId:s}=o,a=r?.split("_")[1]||"",c=await vt(a),u={AuthFlow:"CUSTOM_AUTH",AuthParameters:{USERNAME:e,SRP_A:c.A.toString(16),CHALLENGE_NAME:"SRP_A"},ClientMetadata:n,ClientId:s,UserContextData:xn({username:e,userPoolId:r,userPoolClientId:s})},{ChallengeParameters:l,Session:p}=await ge({region:He(r),userAgentValue:Sn(m.SignIn)},u),h=l?.USERNAME??e;return Vn(h),Ln(Pn,[t,l,n,p,c,o,i],h,i)}(n,o,a,s,Jn),l=Kn(n);return on({signInSession:u,username:l,challengeName:t,signInDetails:r}),c?(await Qn({username:l,...c,NewDeviceMetadata:await kn(s.userPoolId,c.NewDeviceMetadata,c.AccessToken),signInDetails:r}),rn(),e.Hub.dispatch("auth",{event:"signedIn",data:await yn()},"Auth",ze),{isSignedIn:!0,nextStep:{signInStep:"DONE"}}):Rn({challengeName:t,challengeParameters:i})}catch(e){rn(),le(e);const t=Un(e.name);if(t)return t;throw e}}(t)}}const eo=async()=>{throw new de({name:un,message:"The autoSignIn flow has not started, or has been cancelled/completed.",recoverySuggestion:"Please try to use the signIn API or log out before starting a new autoSignIn flow."})};let to=eo;function no(e){to=e}function oo(){to=eo}const io=18e4;function ro(e,t){let n;return function(o){n||e(...o),clearTimeout(n),n=setTimeout((()=>{n=void 0}),t)}}const so=ro((function(e,t,n){const o=Date.now(),i=setInterval((async()=>{if(Date.now()-o>io)return clearInterval(i),ho(!1),n(new de({name:un,message:"The account was not confirmed on time.",recoverySuggestion:"Try to verify your account by clicking the link sent your email or phone and then login manually."})),void oo();try{const n=await Xn(e);if("CONFIRM_SIGN_UP"!==n.nextStep.signInStep)return t(n),clearInterval(i),ho(!1),void oo()}catch(e){clearInterval(i),ho(!1),n(e),oo()}}),5e3)}),300),ao=ro((async function(e,t,n){try{t(await Xn(e)),oo()}catch(e){n(e),oo()}}),300);let co,uo=!1;function lo(e){co=e}function po(){return uo}function ho(e){!1===e&&lo(void 0),uo=e}function fo(e){return!!e.UserConfirmed}function go(e){return async()=>new Promise((async(t,n)=>{ao([e,t,n])}))}const Eo=go;async function mo(t){const{username:n,password:o,options:i}=t,r=e.Amplify.getConfig().Auth?.Cognito,s=r?.signUpVerificationMethod??"code",{clientMetadata:a,validationData:c,autoSignIn:u}=t.options??{};d(r),Ge(!!n,Le.EmptySignUpUsername),Ge(!!o,Le.EmptySignUpPassword);const l="boolean"!=typeof u?u:void 0,p={username:n,options:l};"CUSTOM_WITHOUT_SRP"!==l?.authFlowType&&(p.password=o),(l||!0===u)&&(lo(n),ho(!0));const h=await me({region:He(r.userPoolId),userAgentValue:Sn(m.SignUp)},{Username:n,Password:o,UserAttributes:i?.userAttributes&&We(i?.userAttributes),ClientMetadata:a,ValidationData:c&&We(c),ClientId:r.userPoolClientId}),{UserSub:f,CodeDeliveryDetails:g}=h;if(fo(h)&&po())return no(Eo(p)),{isSignUpComplete:!0,nextStep:{signUpStep:"COMPLETE_AUTO_SIGN_IN"}};if(fo(h)&&!po())return{isSignUpComplete:!0,nextStep:{signUpStep:"DONE"}};if(!fo(h)&&po()&&"code"===s)!function(e){const t=Je.listen("auth-internal",(async({payload:n})=>{if("confirmSignUp"===n.event){const o=n.data;o?.isSignUpComplete&&(Je.dispatch("auth-internal",{event:"autoSignIn"}),no(go(e)),t())}})),n=setTimeout((()=>{t(),ho(!1),clearTimeout(n),oo()}),io)}(p);else if(!fo(h)&&po()&&"link"===s)return no(function(e){return async()=>new Promise((async(t,n)=>{so([e,t,n])}))}(p)),{isSignUpComplete:!1,nextStep:{signUpStep:"COMPLETE_AUTO_SIGN_IN",codeDeliveryDetails:{deliveryMedium:g?.DeliveryMedium,destination:g?.Destination,attributeName:g?.AttributeName}},userId:f};return{isSignUpComplete:!1,nextStep:{signUpStep:"CONFIRM_SIGN_UP",codeDeliveryDetails:{deliveryMedium:g?.DeliveryMedium,destination:g?.Destination,attributeName:g?.AttributeName}},userId:f}}async function yo(t){const n=t.username;Ge(!!n,Le.EmptyResetPasswordUsername);const o=e.Amplify.getConfig().Auth?.Cognito;d(o);const{userPoolClientId:i,userPoolId:r}=o,s=t.options?.clientMetadata,a=xn({username:n,userPoolId:r,userPoolClientId:i}),c=(await Se({region:He(o.userPoolId),userAgentValue:Sn(m.ResetPassword)},{Username:n,ClientMetadata:s,ClientId:o.userPoolClientId,UserContextData:a})).CodeDeliveryDetails;return{isPasswordReset:!1,nextStep:{resetPasswordStep:"CONFIRM_RESET_PASSWORD_WITH_CODE",codeDeliveryDetails:{deliveryMedium:c?.DeliveryMedium,destination:c?.Destination,attributeName:c?.AttributeName}}}}async function So(t){const n=e.Amplify.getConfig().Auth?.Cognito;d(n);const{userPoolClientId:o,userPoolId:i}=n,{username:r,newPassword:s}=t;Ge(!!r,Le.EmptyConfirmResetPasswordUsername),Ge(!!s,Le.EmptyConfirmResetPasswordNewPassword);const a=t.confirmationCode;Ge(!!a,Le.EmptyConfirmResetPasswordConfirmationCode);const c=t.options?.clientMetadata,u=xn({username:r,userPoolId:i,userPoolClientId:o});await xe({region:He(n.userPoolId),userAgentValue:Sn(m.ConfirmResetPassword)},{Username:r,ConfirmationCode:a,Password:s,ClientMetadata:c,ClientId:n.userPoolClientId,UserContextData:u})}async function xo(t){const n=t.username;Ge(!!n,Le.EmptySignUpUsername);const o=e.Amplify.getConfig().Auth?.Cognito;d(o);const{userPoolClientId:i,userPoolId:r}=o,s=t.options?.clientMetadata,a=xn({username:n,userPoolId:r,userPoolClientId:i}),{CodeDeliveryDetails:c}=await we({region:He(o.userPoolId),userAgentValue:Sn(m.ResendSignUpCode)},{Username:n,ClientMetadata:s,ClientId:o.userPoolClientId,UserContextData:a}),{DeliveryMedium:u,AttributeName:l,Destination:p}={...c};return{destination:p,deliveryMedium:u,attributeName:l||void 0}}async function Io(t){const{username:n,confirmationCode:o,options:i}=t,r=e.Amplify.getConfig().Auth?.Cognito;d(r);const{userPoolId:s,userPoolClientId:a}=r,c=i?.clientMetadata;Ge(!!n,Le.EmptyConfirmSignUpUsername),Ge(!!o,Le.EmptyConfirmSignUpCode);const u=xn({username:n,userPoolId:s,userPoolClientId:a});return await ye({region:He(r.userPoolId),userAgentValue:Sn(m.ConfirmSignUp)},{Username:n,ConfirmationCode:o,ClientMetadata:c,ForceAliasCreation:i?.forceAliasCreation,ClientId:r.userPoolClientId,UserContextData:u}),new Promise(((e,t)=>{try{const t={isSignUpComplete:!0,nextStep:{signUpStep:"DONE"}};if(!po()||!function(e){return co===e}(n))return e(t);const o=Je.listen("auth-internal",(({payload:t})=>{"autoSignIn"===t.event&&(e({isSignUpComplete:!0,nextStep:{signUpStep:"COMPLETE_AUTO_SIGN_IN"}}),ho(!1),o())}));Je.dispatch("auth-internal",{event:"confirmSignUp",data:t})}catch(e){t(e)}}))}async function wo(t){const{challengeResponse:n,options:o}=t,{username:i,challengeName:r,signInSession:s,signInDetails:a}=nn.getState(),c=e.Amplify.getConfig().Auth?.Cognito;d(c);const u=o?.clientMetadata;if(Ge(!!n,Le.EmptyChallengeResponse),!i||!r||!s)throw new de({name:Be.SignInException,message:"\n\t\t\tAn error occurred during the sign in process. \n\t\t\t\n\t\t\tThis most likely occurred due to:\n\t\t\t1. signIn was not called before confirmSignIn.\n\t\t\t2. signIn threw an exception.\n\t\t\t3. page was refreshed during the sign in flow.\n\t\t\t",recoverySuggestion:"Make sure a successful call to signIn is made before calling confirmSignInand that the page is not refreshed until the sign in process is done."});try{const{Session:t,ChallengeName:d,AuthenticationResult:l,ChallengeParameters:p}=await async function(e,t,n,o,i,r,s,a){const c=a?.userAttributes,u=a?.friendlyDeviceName;switch(t){case"SMS_MFA":return async function({challengeResponse:e,clientMetadata:t,session:n,username:o,config:i}){const{userPoolId:r,userPoolClientId:s}=i,a={ChallengeName:"SMS_MFA",ChallengeResponses:{USERNAME:o,SMS_MFA_CODE:e},Session:n,ClientMetadata:t,ClientId:s,UserContextData:xn({username:o,userPoolId:r,userPoolClientId:s})};return Ie({region:He(r),userAgentValue:Sn(m.ConfirmSignIn)},a)}({challengeResponse:o,clientMetadata:s,session:n,username:e,config:i});case"SELECT_MFA_TYPE":return async function({challengeResponse:e,username:t,clientMetadata:n,session:o,config:i}){const{userPoolId:r,userPoolClientId:s}=i;Ge("TOTP"===e||"SMS"===e,Le.IncorrectMFAMethod);const a={ChallengeName:"SELECT_MFA_TYPE",ChallengeResponses:{USERNAME:t,ANSWER:_n(e)},Session:o,ClientMetadata:n,ClientId:s,UserContextData:xn({username:t,userPoolId:r,userPoolClientId:s})};return Ie({region:He(r),userAgentValue:Sn(m.ConfirmSignIn)},a)}({challengeResponse:o,clientMetadata:s,session:n,username:e,config:i});case"MFA_SETUP":return async function({challengeResponse:e,username:t,clientMetadata:n,session:o,deviceName:i,config:r}){const{userPoolId:s,userPoolClientId:a}=r,c={USERNAME:t},{Session:u}=await Ae({region:He(s),userAgentValue:Sn(m.ConfirmSignIn)},{UserCode:e,Session:o,FriendlyDeviceName:i});nn.dispatch({type:"SET_SIGN_IN_SESSION",value:u});const d={ChallengeName:"MFA_SETUP",ChallengeResponses:c,Session:u,ClientMetadata:n,ClientId:a};return Ie({region:He(s)},d)}({challengeResponse:o,clientMetadata:s,session:n,username:e,deviceName:u,config:i});case"NEW_PASSWORD_REQUIRED":return async function({challengeResponse:e,clientMetadata:t,session:n,username:o,requiredAttributes:i,config:r}){const{userPoolId:s,userPoolClientId:a}=r,c={ChallengeName:"NEW_PASSWORD_REQUIRED",ChallengeResponses:{...bn(i),NEW_PASSWORD:e,USERNAME:o},ClientMetadata:t,Session:n,ClientId:a,UserContextData:xn({username:o,userPoolId:s,userPoolClientId:a})};return Ie({region:He(s),userAgentValue:Sn(m.ConfirmSignIn)},c)}({challengeResponse:o,clientMetadata:s,session:n,username:e,requiredAttributes:c,config:i});case"CUSTOM_CHALLENGE":return Ln(wn,[{challengeResponse:o,clientMetadata:s,session:n,username:e,config:i,tokenOrchestrator:r}],e,r);case"SOFTWARE_TOKEN_MFA":return async function({challengeResponse:e,clientMetadata:t,session:n,username:o,config:i}){const{userPoolId:r,userPoolClientId:s}=i,a={ChallengeName:"SOFTWARE_TOKEN_MFA",ChallengeResponses:{USERNAME:o,SOFTWARE_TOKEN_MFA_CODE:e},Session:n,ClientMetadata:t,ClientId:s,UserContextData:xn({username:o,userPoolId:r,userPoolClientId:s})};return Ie({region:He(r),userAgentValue:Sn(m.ConfirmSignIn)},a)}({challengeResponse:o,clientMetadata:s,session:n,username:e,config:i})}throw new de({name:Be.SignInException,message:`An error occurred during the sign in process. \n\t\t${t} challengeName returned by the underlying service was not addressed.`})}(i,r,s,n,c,Jn,u,o);return on({signInSession:t,username:i,challengeName:d,signInDetails:a}),l?(rn(),await Qn({username:i,...l,NewDeviceMetadata:await kn(c.userPoolId,l.NewDeviceMetadata,l.AccessToken),signInDetails:a}),e.Hub.dispatch("auth",{event:"signedIn",data:await yn()},"Auth",ze),{isSignedIn:!0,nextStep:{signInStep:"DONE"}}):Rn({challengeName:d,challengeParameters:p})}catch(e){le(e);const t=Un(e.name);if(t)return t;throw e}}async function Ao(t){const{sms:n,totp:o}=t,i=e.Amplify.getConfig().Auth?.Cognito;d(i);const{tokens:r}=await(0,e.fetchAuthSession)({forceRefresh:!1});ln(r),await Ce({region:He(i.userPoolId),userAgentValue:Sn(m.UpdateMFAPreference)},{AccessToken:r.accessToken.toString(),SMSMfaSettings:vo(n),SoftwareTokenMfaSettings:vo(o)})}function vo(e){return"DISABLED"===e?{Enabled:!1}:"PREFERRED"===e?{Enabled:!0,PreferredMfa:!0}:"ENABLED"===e?{Enabled:!0}:"NOT_PREFERRED"===e?{Enabled:!0,PreferredMfa:!1}:void 0}async function Co(){const t=e.Amplify.getConfig().Auth?.Cognito;d(t);const{tokens:n}=await(0,e.fetchAuthSession)({forceRefresh:!1});ln(n);const{PreferredMfaSetting:o,UserMFASettingList:i}=await Pe({region:He(t.userPoolId),userAgentValue:Sn(m.FetchMFAPreference)},{AccessToken:n.accessToken.toString()});return{preferred:Dn(o),enabled:Mn(i)}}async function Po(t){const n=e.Amplify.getConfig().Auth?.Cognito;d(n);const{code:o,options:i}=t;Ge(!!o,Le.EmptyVerifyTOTPSetupCode);const{tokens:r}=await(0,e.fetchAuthSession)({forceRefresh:!1});ln(r),await Ae({region:He(n.userPoolId),userAgentValue:Sn(m.VerifyTOTPSetup)},{AccessToken:r.accessToken.toString(),UserCode:o,FriendlyDeviceName:i?.friendlyDeviceName})}async function Ro(t){const n=e.Amplify.getConfig().Auth?.Cognito;d(n);const{oldPassword:o,newPassword:i}=t;Ge(!!o,Le.EmptyUpdatePassword),Ge(!!i,Le.EmptyUpdatePassword);const{tokens:r}=await(0,e.fetchAuthSession)({forceRefresh:!1});ln(r),await Re({region:He(n.userPoolId),userAgentValue:Sn(m.UpdatePassword)},{AccessToken:r.accessToken.toString(),PreviousPassword:o,ProposedPassword:i})}async function To(){const t=e.Amplify.getConfig().Auth?.Cognito;d(t);const{tokens:n}=await(0,e.fetchAuthSession)({forceRefresh:!1});ln(n);const o=n.idToken?.payload["cognito:username"]??"",{SecretCode:i}=await ve({region:He(t.userPoolId),userAgentValue:Sn(m.SetUpTOTP)},{AccessToken:n.accessToken.toString()});if(!i)throw new de({name:tn,message:"Failed to set up TOTP."});return Tn(i,JSON.stringify(o))}const Uo=async t=>{const{userAttributes:n,options:o}=t,i=e.Amplify.getConfig().Auth?.Cognito,r=o?.clientMetadata;d(i);const{tokens:s}=await(0,e.fetchAuthSession)({forceRefresh:!1});ln(s);const{CodeDeliveryDetailsList:a}=await De({region:He(i.userPoolId),userAgentValue:Sn(m.UpdateUserAttributes)},{AccessToken:s.accessToken.toString(),ClientMetadata:r,UserAttributes:We(n)});return{...No(n),...bo(a)}};function No(e){const t={};return Object.keys(e)?.forEach((e=>{t[e]={isUpdated:!0,nextStep:{updateAttributeStep:"DONE"}}})),t}function bo(e){const t={};return e?.forEach((e=>{const{AttributeName:n,DeliveryMedium:o,Destination:i}=e;n&&(t[n]={isUpdated:!1,nextStep:{updateAttributeStep:"CONFIRM_ATTRIBUTE_WITH_CODE",codeDeliveryDetails:{attributeName:n,deliveryMedium:o,destination:i}}})})),t}const _o=async e=>{const{userAttribute:{attributeKey:t,value:n},options:o}=e,i=await Uo({userAttributes:{[t]:n},options:o});return Object.values(i)[0]};async function Do(t){const n=e.Amplify.getConfig().Auth?.Cognito;d(n);const{confirmationCode:o,userAttributeKey:i}=t;Ge(!!o,Le.EmptyConfirmUserAttributeCode);const{tokens:r}=await(0,e.fetchAuthSession)({forceRefresh:!1});ln(r),await Me({region:He(n.userPoolId),userAgentValue:Sn(m.ConfirmUserAttribute)},{AccessToken:r.accessToken.toString(),AttributeName:i,Code:o})}const Mo=Symbol("oauth-listener"),Fo="amplify-signin-with-hostedUI",Oo="CognitoIdentityServiceProvider";class ko{constructor(e){this.keyValueStorage=e}async clearOAuthInflightData(){d(this.cognitoConfig);const e=Lo(Oo,this.cognitoConfig.userPoolClientId);await Promise.all([this.keyValueStorage.removeItem(e.inflightOAuth),this.keyValueStorage.removeItem(e.oauthPKCE),this.keyValueStorage.removeItem(e.oauthState)])}async clearOAuthData(){d(this.cognitoConfig);const e=Lo(Oo,this.cognitoConfig.userPoolClientId);return await this.clearOAuthInflightData(),await this.keyValueStorage.removeItem(Fo),this.keyValueStorage.removeItem(e.oauthSignIn)}loadOAuthState(){d(this.cognitoConfig);const e=Lo(Oo,this.cognitoConfig.userPoolClientId);return this.keyValueStorage.getItem(e.oauthState)}storeOAuthState(e){d(this.cognitoConfig);const t=Lo(Oo,this.cognitoConfig.userPoolClientId);return this.keyValueStorage.setItem(t.oauthState,e)}loadPKCE(){d(this.cognitoConfig);const e=Lo(Oo,this.cognitoConfig.userPoolClientId);return this.keyValueStorage.getItem(e.oauthPKCE)}storePKCE(e){d(this.cognitoConfig);const t=Lo(Oo,this.cognitoConfig.userPoolClientId);return this.keyValueStorage.setItem(t.oauthPKCE,e)}setAuthConfig(e){this.cognitoConfig=e}async loadOAuthInFlight(){d(this.cognitoConfig);const e=Lo(Oo,this.cognitoConfig.userPoolClientId);return"true"===await this.keyValueStorage.getItem(e.inflightOAuth)}async storeOAuthInFlight(e){d(this.cognitoConfig);const t=Lo(Oo,this.cognitoConfig.userPoolClientId);return await this.keyValueStorage.setItem(t.inflightOAuth,`${e}`)}async loadOAuthSignIn(){d(this.cognitoConfig);const e=Lo(Oo,this.cognitoConfig.userPoolClientId),t=await this.keyValueStorage.getItem(Fo),[n,o]=(await this.keyValueStorage.getItem(e.oauthSignIn))?.split(",")??[];return{isOAuthSignIn:"true"===n||"true"===t,preferPrivateSession:"true"===o}}async storeOAuthSignIn(e,t=!1){d(this.cognitoConfig);const n=Lo(Oo,this.cognitoConfig.userPoolClientId);return await this.keyValueStorage.setItem(n.oauthSignIn,`${e},${t}`)}}const Lo=(e,t)=>jn(En)(e,t),Vo=new ko(e.defaultStorage);var Ko;!function(e){e.NoConfig="noConfig",e.MissingAuthConfig="missingAuthConfig",e.EmptyUsername="emptyUsername",e.InvalidUsername="invalidUsername",e.EmptyPassword="emptyPassword",e.EmptyCode="emptyCode",e.SignUpError="signUpError",e.NoMFA="noMFA",e.InvalidMFA="invalidMFA",e.EmptyChallengeResponse="emptyChallengeResponse",e.NoUserSession="noUserSession",e.Default="default",e.DeviceConfig="deviceConfig",e.NetworkError="networkError",e.AutoSignInError="autoSignInError",e.OAuthSignInError="oauthSignInError"}(Ko||(Ko={}));const Bo=async e=>{const t=await Vo.loadOAuthState(),n=e===t?t:void 0;if(!n)throw new de({name:Ko.OAuthSignInError,message:null===e?"`signInWithRedirect` has been canceled.":"An error occurred while validating the state.",recoverySuggestion:null===e?void 0:"Try to initiate an OAuth flow from Amplify"});return n},qo=[],Go=()=>{for(;qo.length;)qo.pop()?.()};new e.ConsoleLogger("AuthError");const Ho={message:Ke.OAUTH_ERROR,log:"Make sure Cognito Hosted UI has been configured correctly"},Wo=(Ke.DEFAULT_MSG,Ke.DEFAULT_MSG,Ke.EMPTY_USERNAME,Ke.INVALID_USERNAME,Ke.EMPTY_PASSWORD,Ke.EMPTY_CODE,Ke.SIGN_UP_ERROR,Ke.NO_MFA,Ke.INVALID_MFA,Ke.EMPTY_CHALLENGE,Ke.NO_USER_SESSION,Ke.DEVICE_CONFIG,Ke.NETWORK_ERROR,Ke.AUTOSIGNIN_ERROR,Ke.DEFAULT_MSG,(e,t)=>new de({message:e??"An error has occurred during the oauth process.",name:Be.OAuthSignInError,recoverySuggestion:t??Ho.log})),$o=async({redirectUri:t,state:n,preferPrivateSession:o})=>{var i;await Vo.clearOAuthData(),await Vo.storeOAuthSignIn(!0,o),Go(),Zn.setWaitForInflightOAuth((async()=>{})),jo(n)&&e.Hub.dispatch("auth",{event:"customOAuthState",data:(i=zo(n),(i.match(/.{2}/g)||[]).map((e=>String.fromCharCode(parseInt(e,16)))).join(""))},"Auth",ze),e.Hub.dispatch("auth",{event:"signInWithRedirect"},"Auth",ze),e.Hub.dispatch("auth",{event:"signedIn",data:await yn()},"Auth",ze),Yo(t)},jo=e=>/-/.test(e),zo=e=>e.split("-").splice(1).join("-"),Yo=e=>{"undefined"!=typeof window&&void 0!==window.history&&window.history.replaceState(window.history.state,"",e)};function Zo(e){return e[0]}"undefined"!=typeof window&&void 0!==window.document&&e.Amplify[Mo]((async t=>{try{d(t),l(t),Vo.setAuthConfig(t)}catch(e){return}if(!await Vo.loadOAuthInFlight())return;const n=new Promise(((e,t)=>{var n;n=e,qo.push(n)}));Zn.setWaitForInflightOAuth((()=>n));try{const n=window.location.href,{loginWith:o,userPoolClientId:i}=t,{domain:r,redirectSignIn:s,responseType:a}=o.oauth,c=Zo(s);await(async({currentUrl:t,userAgentValue:n,clientId:o,redirectUri:i,responseType:r,domain:s,preferPrivateSession:a})=>{const c=new G(t),u=c.searchParams.get("error"),d=c.searchParams.get("error_description");if(u)throw Wo(d??u);return"code"===r?(async({currentUrl:t,userAgentValue:n,clientId:o,redirectUri:i,domain:r,preferPrivateSession:s})=>{const a=new G(t),c=a.searchParams.get("code"),u=a.searchParams.get("state");if(!c||!u)throw Wo("User cancelled OAuth flow.");const d=await Bo(u),l="https://"+r+"/oauth2/token",p=await Vo.loadPKCE(),h={grant_type:"authorization_code",code:c,client_id:o,redirect_uri:i,...p?{code_verifier:p}:{}},f=Object.entries(h).map((([e,t])=>`${encodeURIComponent(e)}=${encodeURIComponent(t)}`)).join("&"),{access_token:g,refresh_token:E,id_token:m,error:y,error_message:S,token_type:x,expires_in:I}=await(await fetch(l,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","x-amz-user-agent":n},body:f})).json();if(y)throw Wo(S??y);const w=(g&&(0,e.decodeJWT)(g).payload.username)??"username";return await Qn({username:w,AccessToken:g,IdToken:m,RefreshToken:E,TokenType:x,ExpiresIn:I}),$o({redirectUri:i,state:d,preferPrivateSession:s})})({currentUrl:t,userAgentValue:n,clientId:o,redirectUri:i,domain:s,preferPrivateSession:a}):(async({currentUrl:t,redirectUri:n,preferPrivateSession:o})=>{const i=new G(t),{id_token:r,access_token:s,state:a,token_type:c,expires_in:u,error_description:d,error:l}=(i.hash??"#").substring(1).split("&").map((e=>e.split("="))).reduce(((e,[t,n])=>({...e,[t]:n})),{id_token:void 0,access_token:void 0,state:void 0,token_type:void 0,expires_in:void 0,error_description:void 0,error:void 0});if(l)throw Wo(d??l);if(!s)throw Wo("No access token returned from OAuth flow.");const p=await Bo(a),h=(s&&(0,e.decodeJWT)(s).payload.username)??"username";return await Qn({username:h,AccessToken:s,IdToken:r,TokenType:c,ExpiresIn:u}),$o({redirectUri:n,state:p,preferPrivateSession:o})})({currentUrl:t,redirectUri:i,preferPrivateSession:a})})({currentUrl:n,clientId:i,domain:r,redirectUri:c,responseType:a,userAgentValue:Sn(m.SignInWithRedirect)})}catch(t){await(async t=>{Go(),await Vo.clearOAuthInflightData(),e.Hub.dispatch("auth",{event:"signInWithRedirect_failure",data:{error:t}},"Auth",ze)})(t)}}));const Jo={Google:"Google",Facebook:"Facebook",Amazon:"LoginWithAmazon",Apple:"SignInWithApple"};async function Qo(t){const n=e.Amplify.getConfig().Auth?.Cognito;d(n),l(n),Vo.setAuthConfig(n),await On();let o="COGNITO";return"string"==typeof t?.provider?o=Jo[t.provider]:t?.provider?.custom&&(o=t.provider.custom),Xo({oauthConfig:n.loginWith.oauth,clientId:n.userPoolClientId,provider:o,customState:t?.customState,preferPrivateSession:t?.options?.preferPrivateSession})}const Xo=async({oauthConfig:e,provider:t,clientId:n,customState:o,preferPrivateSession:i})=>{const{domain:r,redirectSignIn:s,responseType:a,scopes:u}=e,d=(e=>{let t="";for(let e=0;e<32;e++)t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return t})(),l=o?`${d}-${p=o,p.split("").map((e=>e.charCodeAt(0).toString(16).padStart(2,"0"))).join("")}`:d;var p;const{value:h,method:f,toCodeChallenge:g}=(e=>{const t=new Uint8Array(e);c().getRandomValues(t);let n,o="";for(let e of t)o+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(e%62);return{value:o,method:"S256",toCodeChallenge:()=>n||(n=function(e){const t=new gt.Sha256;return t.update(e),Qe.convert(t.digestSync(),{urlSafe:!0}).replace(/=/g,"")}(o),n)}})(128),E=Zo(e.redirectSignIn);return Vo.storeOAuthInFlight(!0),Vo.storeOAuthState(l),Vo.storePKCE(h),`https://${r}/oauth2/authorize?${Object.entries({redirect_uri:E,response_type:a,client_id:n,identity_provider:t,scope:u.join(" "),state:l,..."code"===a&&{code_challenge:g(),code_challenge_method:f}}).map((([e,t])=>`${encodeURIComponent(e)}=${encodeURIComponent(t)}`)).join("&")}`},ei=()=>(async e=>{const t=e.getConfig().Auth?.Cognito;d(t);const{tokens:n}=await((e,t)=>e.Auth.fetchAuthSession({forceRefresh:!1}))(e);ln(n);const{UserAttributes:o}=await Pe({region:He(t.userPoolId),userAgentValue:Sn(m.FetchUserAttributes)},{AccessToken:n.accessToken.toString()});return function(e){const t={};return e?.forEach((e=>{e.Name&&(t[e.Name]=e.Value)})),t}(o)})(e.Amplify),ti=async(t,n)=>{await n.loadOAuthSignIn(),await(async t=>{await t.clearOAuthData(),Jn.clearTokens(),await(0,e.clearCredentials)(),e.Hub.dispatch("auth",{event:"signedOut"},"Auth",ze)})(n)},ni=new e.ConsoleLogger("Auth");async function oi(t){const n=e.Amplify.getConfig().Auth?.Cognito;let o;d(n),t?.global?await async function(e){try{const t=await Jn.getTokenStore().loadTokens();ln(t),await _e({region:He(e.userPoolId),userAgentValue:Sn(m.SignOut)},{AccessToken:t.accessToken.toString()})}catch(e){ni.debug("Global signOut error caught but will proceed with token removal")}}(n):await async function(e){try{const t=await Jn.getTokenStore().loadTokens();fn(t),ii(t.accessToken)&&await Ee({region:He(e.userPoolId),userAgentValue:Sn(m.SignOut)},{ClientId:e.userPoolClientId,Token:t.refreshToken})}catch(e){ni.debug("Client signOut error caught but will proceed with token removal")}}(n);try{l(n),o=!0}catch(e){o=!1}if(o){const t=new ko(e.defaultStorage);t.setAuthConfig(n);const{type:o}=await ti(n,t)??{};if("error"===o)throw new de({name:dn,message:"An error occurred when attempting to log out from OAuth provider."})}else Jn.clearTokens(),await(0,e.clearCredentials)(),e.Hub.dispatch("auth",{event:"signedOut"},"Auth",ze)}const ii=e=>!!e?.payload?.origin_jti,ri=async t=>{const{userAttributeKey:n,options:o}=t,i=e.Amplify.getConfig().Auth?.Cognito,r=o?.clientMetadata;d(i);const{tokens:s}=await(0,e.fetchAuthSession)({forceRefresh:!1});ln(s);const{CodeDeliveryDetails:a}=await be({region:He(i.userPoolId),userAgentValue:Sn(m.SendUserAttributeVerificationCode)},{AccessToken:s.accessToken.toString(),ClientMetadata:r,AttributeName:n}),{DeliveryMedium:c,AttributeName:u,Destination:l}={...a};return{destination:l,deliveryMedium:c,attributeName:u}};async function si(t){const n=e.Amplify.getConfig().Auth?.Cognito;d(n);const{userAttributeKeys:o}=t,{tokens:i}=await(0,e.fetchAuthSession)({forceRefresh:!1});ln(i),await ke({region:He(n.userPoolId),userAgentValue:Sn(m.DeleteUserAttributes)},{AccessToken:i.accessToken.toString(),UserAttributeNames:o})}async function ai(){const t=e.Amplify.getConfig().Auth?.Cognito;d(t);const{tokens:n}=await(0,e.fetchAuthSession)();ln(n),await Ne({region:He(t.userPoolId),userAgentValue:Sn(m.DeleteUser)},{AccessToken:n.accessToken.toString()}),await Jn.clearDeviceMetadata(),await oi()}async function ci(){const t=e.Amplify.getConfig().Auth?.Cognito;d(t);const{tokens:n}=await(0,e.fetchAuthSession)();ln(n);const o=await(Jn?.getDeviceMetadata());gn(o),await Fe({region:He(t.userPoolId),userAgentValue:Sn(m.RememberDevice)},{AccessToken:n.accessToken.toString(),DeviceKey:o.deviceKey,DeviceRememberedStatus:"remembered"})}async function ui(t){const{device:{id:n}={id:void 0}}=t??{},o=e.Amplify.getConfig().Auth?.Cognito;d(o);const{tokens:i}=await(0,e.fetchAuthSession)();ln(i);const r=await Jn.getDeviceMetadata(),s=r?.deviceKey;n||gn(r),await Ue({region:He(o.userPoolId),userAgentValue:Sn(m.ForgetDevice)},{AccessToken:i.accessToken.toString(),DeviceKey:n??s}),n&&n!==s||await Jn.clearDeviceMetadata()}const di=60;async function li(){const t=e.Amplify.getConfig().Auth?.Cognito;d(t);const{tokens:n}=await(0,e.fetchAuthSession)();ln(n);const o=await Oe({region:He(t.userPoolId),userAgentValue:Sn(m.FetchDevices)},{AccessToken:n.accessToken.toString(),Limit:di});return pi(o.Devices??[])}const pi=async e=>e.map((({DeviceKey:e="",DeviceAttributes:t=[],DeviceCreateDate:n,DeviceLastModifiedDate:o,DeviceLastAuthenticatedDate:i})=>({id:e,attributes:t.reduce(((e,{Name:t,Value:n})=>(t&&n&&(e[t]=n),e)),{}),createDate:n?new Date(1e3*n):void 0,lastModifiedDate:o?new Date(1e3*o):void 0,lastAuthenticatedDate:i?new Date(1e3*i):void 0})))})(),i})()));
//# sourceMappingURL=aws-amplify-auth.min.js.map